{"version":3,"sources":["component/my-music/my-music.js"],"names":["app","getApp","adList","videoAd","Component","properties","data","show","currentIndex","lifetimes","ready","wx","createRewardedVideoAd","adUnitId","Math","floor","random","onError","console","log","res","that","gs","setData","musicPlay","playBackgroundAudio","dataUrl","music","title","name","coverImgUrl","image","cloud","getMusic","then","su","musicList","methods","_getTemplate","e","catch","load","err","_playMusic","currentTarget","dataset","index","stopBackgroundAudio","_showMusic","pageLifetimes"],"mappings":";;AAAA;AACA;AACA;AACA,IAAMA,MAAMC,QAAZ;AACA,IAAMC,SAAS,CAAC,yBAAD,EAA4B,yBAA5B,EAAuD,yBAAvD,EAAkF,yBAAlF,EAA6G,yBAA7G,EAAwI,yBAAxI,EAAmK,yBAAnK,EAA8L,yBAA9L,EAAyN,yBAAzN,EAAoP,yBAApP,EAA+Q,yBAA/Q,EAA0S,yBAA1S,CAAf;AACA,IAAIC,UAAU,IAAd;AACAC,UAAU;AACRC,cAAY,EADJ;AAERC,QAAM;AACJC,UAAM,KADF;AAEJC,kBAAc,CAAC;AAFX,GAFE;AAMRC,aAAW;AACTC,SADS,mBACA;AACP,UAAIC,GAAGC,qBAAP,EAA8B;AAC5BT,kBAAUQ,GAAGC,qBAAH,CAAyB;AACjCC,oBAAUX,OAAOY,KAAKC,KAAL,CAAWD,KAAKE,MAAL,KAAgB,EAA3B,CAAP;AADuB,SAAzB,CAAV;AAGAb,gBAAQc,OAAR,CAAgB,eAAO;AACrBC,kBAAQC,GAAR,CAAY,SAAZ,EAAuBC,GAAvB;AACD,SAFD;AAGD;AACD,UAAIC,OAAO,IAAX;AACA,UAAIrB,IAAIsB,EAAJ,CAAO,WAAP,CAAJ,EAAyB;AACvB,aAAKC,OAAL,CAAa;AACXC,qBAAWxB,IAAIsB,EAAJ,CAAO,WAAP;AADA,SAAb;AAGAX,WAAGc,mBAAH,CAAuB;AACrBC,mBAAS1B,IAAIsB,EAAJ,CAAO,WAAP,EAAoBK,KADR;AAErBC,iBAAO5B,IAAIsB,EAAJ,CAAO,WAAP,EAAoBO,IAFN;AAGrBC,uBAAa9B,IAAIsB,EAAJ,CAAO,WAAP,EAAoBS;AAHZ,SAAvB;AAKD;AACD,UAAI,CAAC/B,IAAIsB,EAAJ,CAAO,WAAP,CAAL,EAA0B;AACxBtB,YAAIgC,KAAJ,GAAYC,QAAZ,GAAuBC,IAAvB,CAA4B,eAAO;AACjClC,cAAImC,EAAJ,CAAO,WAAP,EAAoBf,GAApB;AACAC,eAAKE,OAAL,CAAa;AACXa,uBAAWhB;AADA,WAAb;AAGD,SALD;AAMD,OAPD,MAOO;AACL,aAAKG,OAAL,CAAa;AACXa,qBAAWpC,IAAIsB,EAAJ,CAAO,WAAP;AADA,SAAb;AAGD;AACF;AAjCQ,GANH;AAyCRe,WAAS;AACPC,gBADO,wBACOC,CADP,EACW;AAChB;AACA;AACA;AACA;AACA;AACA;AACA;AACA,UAAI,KAAKjC,IAAL,CAAUE,YAAV,GAAyB,CAAzB,IAA8B,CAAC,KAAKF,IAAL,CAAUC,IAA7C,EAAmD;AACjD,YAAIJ,OAAJ,EAAa;AACXA,kBAAQI,IAAR,GAAeiC,KAAf,CAAqB,YAAM;AACzBrC,oBAAQsC,IAAR,GACGP,IADH,CACQ;AAAA,qBAAM/B,QAAQI,IAAR,EAAN;AAAA,aADR,EAEGiC,KAFH,CAES,eAAO;AACZtB,sBAAQC,GAAR,CAAYuB,GAAZ;AACAxB,sBAAQC,GAAR,CAAY,aAAZ;AACD,aALH;AAMD,WAPD;AAQD;AACF;AACF,KArBM;AAsBPwB,cAtBO,sBAsBKJ,CAtBL,EAsBQ;AACb,UAAIA,EAAEK,aAAF,CAAgBC,OAAhB,CAAwBC,KAAxB,IAAiC,KAAKxC,IAAL,CAAUE,YAA/C,EAA6D;AAC3DG,WAAGoC,mBAAH;AACA,aAAKxB,OAAL,CAAa;AACXC,qBAAW,IADA;AAEXhB,wBAAc,CAAC;AAFJ,SAAb;AAIA;AACD;AACDG,SAAGc,mBAAH,CAAuB;AACrBC,iBAAS,KAAKpB,IAAL,CAAU8B,SAAV,CAAoBG,EAAEK,aAAF,CAAgBC,OAAhB,CAAwBC,KAA5C,EAAmDnB,KADvC;AAErBC,eAAO,KAAKtB,IAAL,CAAU8B,SAAV,CAAoBG,EAAEK,aAAF,CAAgBC,OAAhB,CAAwBC,KAA5C,EAAmDjB,IAFrC;AAGrBC,qBAAa,KAAKxB,IAAL,CAAU8B,SAAV,CAAoBG,EAAEK,aAAF,CAAgBC,OAAhB,CAAwBC,KAA5C,EAAmDf;AAH3C,OAAvB;AAKA/B,UAAImC,EAAJ,CAAO,WAAP,EAAoB,KAAK7B,IAAL,CAAU8B,SAAV,CAAoBG,EAAEK,aAAF,CAAgBC,OAAhB,CAAwBC,KAA5C,CAApB;AACA,WAAKvB,OAAL,CAAa;AACXf,sBAAc+B,EAAEK,aAAF,CAAgBC,OAAhB,CAAwBC,KAD3B;AAEXtB,mBAAW,KAAKlB,IAAL,CAAU8B,SAAV,CAAoBG,EAAEK,aAAF,CAAgBC,OAAhB,CAAwBC,KAA5C;AAFA,OAAb;AAID,KAzCM;AA0CPE,cA1CO,wBA0CO;AACZ,WAAKzB,OAAL,CAAa;AACXhB,cAAM,CAAC,KAAKD,IAAL,CAAUC;AADN,OAAb;AAGD;AA9CM,GAzCD;AAyFR0C,iBAAe;AACb1C,QADa,kBACL,CAEP;AAHY;AAzFP,CAAV","file":"my-music.js","sourcesContent":["// components/component-tag-name.js\r\n// const app = getApp()\r\n/*eslint-disable*/\r\nconst app = getApp()\r\nconst adList = ['adunit-15c9aebab12c662a', 'adunit-8645b4208690d115', 'adunit-15c9aebab12c662a', 'adunit-8645b4208690d115', 'adunit-15c9aebab12c662a', 'adunit-8645b4208690d115', 'adunit-15c9aebab12c662a', 'adunit-8645b4208690d115', 'adunit-15c9aebab12c662a', 'adunit-8645b4208690d115', 'adunit-15c9aebab12c662a', 'adunit-8645b4208690d115']\r\nlet videoAd = null\r\nComponent({\r\n  properties: {},\r\n  data: {\r\n    show: false,\r\n    currentIndex: -1\r\n  },\r\n  lifetimes: {\r\n    ready () {\r\n      if (wx.createRewardedVideoAd) {\r\n        videoAd = wx.createRewardedVideoAd({\r\n          adUnitId: adList[Math.floor(Math.random() * 10)]\r\n        })\r\n        videoAd.onError(res => {\r\n          console.log('onError', res)\r\n        })\r\n      }\r\n      let that = this\r\n      if (app.gs('musicPlay')) {\r\n        this.setData({\r\n          musicPlay: app.gs('musicPlay')\r\n        })\r\n        wx.playBackgroundAudio({\r\n          dataUrl: app.gs('musicPlay').music,\r\n          title: app.gs('musicPlay').name,\r\n          coverImgUrl: app.gs('musicPlay').image\r\n        })\r\n      }\r\n      if (!app.gs('musicList')) {\r\n        app.cloud().getMusic().then(res => {\r\n          app.su('musicList', res)\r\n          that.setData({\r\n            musicList: res\r\n          })\r\n        })\r\n      } else {\r\n        this.setData({\r\n          musicList: app.gs('musicList')\r\n        })\r\n      }\r\n    }\r\n  },\r\n  methods: {\r\n    _getTemplate (e)  {\r\n      // app.cloud().sendformid({formid: e.detail.formId})\r\n      //   .then(res => {\r\n      //     console.log(res)\r\n      //   }, err => {\r\n      //     console.log(err)\r\n      //   })\r\n      // 在页面中定义插屏广告\r\n      if (this.data.currentIndex < 0 && !this.data.show) {\r\n        if (videoAd) {\r\n          videoAd.show().catch(() => {\r\n            videoAd.load()\r\n              .then(() => videoAd.show())\r\n              .catch(err => {\r\n                console.log(err)\r\n                console.log('激励视频 广告显示失败')\r\n              })\r\n          })\r\n        }\r\n      }\r\n    },\r\n    _playMusic (e) {\r\n      if (e.currentTarget.dataset.index == this.data.currentIndex) {\r\n        wx.stopBackgroundAudio()\r\n        this.setData({\r\n          musicPlay: null,\r\n          currentIndex: -1\r\n        })\r\n        return\r\n      }\r\n      wx.playBackgroundAudio({\r\n        dataUrl: this.data.musicList[e.currentTarget.dataset.index].music,\r\n        title: this.data.musicList[e.currentTarget.dataset.index].name,\r\n        coverImgUrl: this.data.musicList[e.currentTarget.dataset.index].image\r\n      })\r\n      app.su('musicPlay', this.data.musicList[e.currentTarget.dataset.index])\r\n      this.setData({\r\n        currentIndex: e.currentTarget.dataset.index,\r\n        musicPlay: this.data.musicList[e.currentTarget.dataset.index]\r\n      })\r\n    },\r\n    _showMusic () {\r\n      this.setData({\r\n        show: !this.data.show\r\n      })\r\n    }\r\n  },\r\n  pageLifetimes: {\r\n    show () {\r\n\r\n    }\r\n  }\r\n})\r\n"]}