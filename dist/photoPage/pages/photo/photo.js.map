{"version":3,"sources":["photoPage/pages/photo/photo.js"],"names":["app","getApp","md5","require","upng","app_key","app_id","Page","data","showImg","chooseImage","that","wx","count","success","res","setData","tempFilePaths","BackshowImg","doUpload","filePath","cloud","login","then","uploadFile","cloudPath","openid","match","getBottomList","wxrequest","url","baseDomain","bottomList","getApi","base64Img","model","params","image","nonce_str","Math","random","toString","substr","time_stamp","parseInt","Date","getTime","genRequestSign","method","header","hideLoading","ret","showToast","title","fail","sortObject","paramStr","keys","Object","idx","key","encodeURIComponent","hexMD5","toUpperCase","obj","sort","newObj","i","length","getbase64","e","showLoading","mask","createSelectorQuery","select","fields","size","setCanvas","width","height","currentTarget","dataset","exec","wdith","ctx","createCanvasContext","drawImage","draw","canvasGetImageData","canvasId","x","y","console","log","platform","getSystemInfoSync","reverseImgData","pngData","encode","buffer","base64","arrayBufferToBase64","w","h","con","j","savePhoto","shareImg","ctxW","ctxH","getImageInfo","src","XS","windowWidth","setFillStyle","fillRect","setFontSize","setTextAlign","setTextBaseline","fillText","qrcode","setTimeout","canvasToTempFilePath","saveImageToPhotosAlbum","tempFilePath","icon","duration","onLoad","loading","getSystemInfo","pixelRatio","windowHeight","getPhotoKey","k","onReady","onShow","onShareAppMessage","path","onHide","onUnload","onPullDownRefresh"],"mappings":"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","file":"photo.js","sourcesContent":["/*eslint-disable*/\n// 获取全局应用程序实例对象\nconst app = getApp()\nconst md5 = require('../wxmd5')\nconst upng = require('../UPNG.js')\nlet app_key = null\nlet app_id = null\n// 创建页面实例对象\nPage({\n  /**\n   * 页面的初始数据\n   */\n  data: {\n    showImg: ''\n  },\n  chooseImage () {\n    let that = this\n    wx.chooseImage({\n      count: 1,\n      success (res) {\n        that.setData({\n          showImg: res.tempFilePaths[0],\n          BackshowImg: null\n        })\n        that.doUpload(res.tempFilePaths[0])\n      }\n    })\n  },\n  // 上传图片\n  doUpload: function (filePath) {\n    app.cloud().login()\n      .then(res => {\n        wx.cloud.uploadFile({\n          cloudPath: `userUp/${res.openid}` + filePath.match(/\\.[^.]+/g)[1] + filePath.match(/\\.[^.]+?$/)[0],\n          filePath\n        })\n      })\n\n  },\n  getBottomList () {\n    let that = this\n    app.wxrequest({\n      url: app.data.baseDomain + '/api/tuFun.json',\n      data: {},\n      success (res) {\n        that.setData({\n          showImg: res.data[0].showImg,\n          bottomList: res.data[0].bottomList\n        })\n      }\n    })\n  },\n  // 获取腾讯AI机器视觉api\n  getApi (base64Img, model) {\n    let that = this\n    let params = {\n      app_id: app_id,\n      image: base64Img,\n      nonce_str: Math.random().toString(36).substr(2),\n      model: model || 1,\n      time_stamp: parseInt(new Date().getTime() / 1000).toString()\n    }\n    params['sign'] = this.genRequestSign(params)\n    // console.log(params);\n    app.wxrequest({\n      url: 'https://api.ai.qq.com/fcgi-bin/ptu/ptu_facemerge',\n      method: 'POST',\n      header: 'application/x-www-form-urlencoded',\n      data: params,\n      success (res) {\n        wx.hideLoading()\n        if (res.data.ret != 0) {\n          return wx.showToast({\n            title: '酷到无法识别'\n          })\n        }\n        that.setData({\n          BackshowImg: \"data:image/png;base64,\" + res.data.data.image\n        })\n      },\n      fail () {\n        wx.hideLoading()\n        wx.showToast({\n          title: '囧服务器崩了'\n        })\n      }\n    })\n  },\n  genRequestSign (params)  {\n    // 1. 对请求参数按字典升序排序\n    params = this.sortObject(params)\n    // 2. 拼接键值对，value部分进行URL编码\n    let paramStr = ''\n    let keys = Object.keys(params)\n    for (let idx in keys) {\n      let key = keys[idx]\n      paramStr += key + '=' + encodeURIComponent(params[key]) + '&'\n    }\n    // 3. 拼接key\n    paramStr += 'app_key=' + app_key\n    // 4. md5\n    return md5.hexMD5(paramStr).toUpperCase()\n  },\n  sortObject (obj)  {\n    var keys = Object.keys(obj).sort()\n    var newObj = {}\n    for (var i = 0; i < keys.length; i++) {\n      newObj[keys[i]] = obj[keys[i]]\n    }\n    return newObj\n  },\n\n  getbase64 (e) {\n    wx.showLoading({\n      title: '努力转换中',\n      mask: true\n    })\n    let that = this\n    wx.createSelectorQuery().select('#showImg').fields({\n      size: true\n    }, function (res) {\n      that.setCanvas(res.width, res.height, e.currentTarget.dataset.model)\n    }).exec()\n  },\n\n  setCanvas (wdith, height, model) {\n    let that = this\n    this.setData({\n      wdith,\n      height\n    })\n    let ctx = wx.createCanvasContext('myCanvas')\n    ctx.drawImage(this.data.showImg, 0, 0, wdith, height)\n    ctx.draw(false, () => {  // 基础库版本需在1.9.0以上\n      wx.canvasGetImageData({\n        canvasId: 'myCanvas',\n        x: 0,\n        y: 0,\n        width: wdith,\n        height: height,\n        success(res) {\n          console.log(res)\n          let platform = wx.getSystemInfoSync().platform\n          if (platform == 'ios' && that.data.showImg !== 'https://7465-teach-1258324355.tcb.qcloud.la/image/photo.png') {\n            res = that.reverseImgData(res)\n          }\n          let pngData = upng.encode([res.data.buffer], res.width, res.height)\n          let base64 = wx.arrayBufferToBase64(pngData)\n          that.getApi(base64, model)\n        }\n      })\n    })\n  },\n  reverseImgData(res) {\n    var w = res.width\n    var h = res.height\n    let con = 0\n    for (var i = 0; i < h / 2; i++) {\n      for (var j = 0; j < w * 4; j++) {\n        con = res.data[i * w * 4 + j]\n        res.data[i * w * 4 + j] = res.data[(h - i - 1) * w * 4 + j]\n        res.data[(h - i - 1) * w * 4 + j] = con\n      }\n    }\n    return res\n  },\n  savePhoto () {\n    let that = this\n    wx.createSelectorQuery().select('#showImg').fields({\n      size: true\n    }, function (res) {\n      that.shareImg(res.width, res.height)\n    }).exec()\n  },\n  // 绘图分享图片\n  shareImg (ctxW, ctxH) {\n    let that = this\n    wx.getImageInfo({\n      src: that.data.BackshowImg,\n      success (res) {\n        console.log(res)\n      }\n    })\n    let ctx = wx.createCanvasContext('myCanvas')\n    let XS = that.data.windowWidth / 375\n    ctx.setFillStyle('#ffffff')\n    ctx.fillRect(0, 0, ctxW, ctxH)\n    ctx.drawImage(that.data.BackshowImg, 0, 0, ctxW, ctxH)\n    ctx.setFontSize(14 * XS)\n    ctx.setFillStyle('#999999')\n    ctx.setTextAlign('right')\n    ctx.setTextBaseline('middle')\n    ctx.fillText('长按识别小程序码访问', ctxW / 2 - 90 * XS, 170 * XS + 100)\n    ctx.drawImage(that.data.qrcode, ctxW - 40, ctxH - 40, 40, 40)\n    ctx.draw()\n    setTimeout(() => {\n      wx.canvasToTempFilePath({\n        canvasId: 'myCanvas',\n        success: function (res) {\n          wx.saveImageToPhotosAlbum({\n            filePath: res.tempFilePath,\n            success () {\n              wx.showToast({\n                title: '图片保存成功',\n                icon: 'success',\n                duration: 2000\n              })\n            }\n          })\n        }\n      })\n    }, 200)\n  },\n  /**\n   * 生命周期函数--监听页面加载\n   */\n  onLoad () {\n    // TODO: onLoad\n    let that = this\n    this.setData({\n      loading: true\n    })\n    wx.getSystemInfo({\n      success: function (res) {\n        that.setData({\n          pixelRatio: res.pixelRatio,\n          windowWidth: res.windowWidth,\n          windowHeight: res.windowHeight\n        })\n      }\n    })\n    this.getBottomList()\n    app.cloud().getPhotoKey()\n      .then(res => {\n        app_key = res.k\n        app_id = res.i\n        that.setData({\n          loading: false\n        })\n      })\n  },\n\n  /**\n   * 生命周期函数--监听页面初次渲染完成\n   */\n  onReady () {\n    // TODO: onReady\n  },\n\n  /**\n   * 生命周期函数--监听页面显示\n   */\n  onShow () {\n    // TODO: onShow\n  },\n  onShareAppMessage: function onShareAppMessage() {\n    return {\n      title: '图FUN',\n      path: '/pages/index/index',\n      success: function success(res) {\n        // 分享成功\n      },\n      fail: function fail(res) {\n        // 分享失败\n      }\n    };\n  },\n  /**\n   * 生命周期函数--监听页面隐藏\n   */\n  onHide () {\n    // TODO: onHide\n  },\n\n  /**\n   * 生命周期函数--监听页面卸载\n   */\n  onUnload () {\n    // TODO: onUnload\n  },\n\n  /**\n   * 页面相关事件处理函数--监听用户下拉动作\n   */\n  onPullDownRefresh () {\n    // TODO: onPullDownRefresh\n    // let that = this\n    // let choose = this.data.choose\n    // if (choose === this.data.videoArr.length) {\n    //   let ojbs = {\n    //     url: that.data.secondUrl,\n    //     success (res) {\n    //       let videoArr = []\n    //       for (let i of res.data.data.data) {\n    //         // console.log(i['group']['480p_video']['url_list'][0])\n    //         videoArr.push(i['group']['480p_video']['url_list'][0]['url'].replace('http://', 'https://'))\n    //       }\n    //       // let videoArr = res.data.data.data\n    //       that.setData({\n    //         choose: 0,\n    //         videoArr: videoArr\n    //       })\n    //     }\n    //   }\n    //   app.wxrequest(ojbs)\n    // } else {\n    //   ++choose\n    //   this.setData({\n    //     choose: choose\n    //   })\n    // }\n    // this.setData({\n    //   autoplays: true\n    // })\n    // this.videoContext = wx.createVideoContext('videos')\n    // setTimeout(function () {\n    //   that.videoContext.play()\n    //   wx.stopPullDownRefresh()\n    // }, 200)\n  }\n})\n"]}