{"version":3,"sources":["photoPage/pages/UPNG.js"],"names":["UPNG","pako","require","module","exports","toRGBA8","out","w","width","h","height","tabs","acTL","decodeImage","data","buffer","frms","frames","img","empty","Uint8Array","i","length","frm","fx","rect","x","fy","y","fw","fh","fdata","blend","_copyTile","push","slice","dispose","pi","area","bpp","decode","_getBPP","bpl","Math","ceil","bf","bf32","Uint32Array","ctype","depth","rs","_bin","readUshort","qarea","ts","tr","tg","tb","qi","ti","p","ap","tl","s0","t0","j","cj","di","gr","al","buff","offset","bin","rUs","rUi","readUint","dd","doff","fd","foff","mgck","len","type","readASCII","_IHDR","num_frames","num_plays","fr","_decompress","rct","del","delay","round","nz","nextZero","keyw","text","off","cflag","cmeth","ltag","tkeyw","readUTF8","readBytes","pl","crc","compress","interlace","filter","_inflate","_filterZero","_readInterlace","cbpp","starting_row","starting_col","row_increment","col_increment","pass","ri","ci","sw","sh","cr","cc","bpll","row","col","cdi","val","ii","noc","paeth","_paeth","a","b","c","pa","abs","pb","pc","writeUshort","n","writeUint","l","s","String","fromCharCode","writeASCII","charCodeAt","arr","pad","ns","toString","decodeURIComponent","e","sb","tw","th","xoff","yoff","mode","min","si","fa","fg","fb","ba","br","bg","bb","ifa","oa","ioa","encode","bufs","ps","dels","forbidPlte","byteLength","wr","wUi","wUs","wAs","nimg","compressPNG","anim","dl","plte","r","g","gotAlpha","fi","imgd","cimg","ioff","nw","nh","forGIF","alphaAnd","ilen","cmap","qres","quantize","est","rgba","img32","brute","cimg32","nx","ny","tlim","tstp","tarea","it","pimg","p32","mix","miy","max","may","sarea","nimg32","fls","t","_filterLine","tsize","table","tab","k","update","buf","o","roundAlpha","imgs","totl","alphaMul","noff","il","root","i0","i1","bst","tdst","left","right","stats","estats","leafs","maxL","mi","L","node","splitPixels","eMq255","ln","rn","R","m","N","sort","planeDst","stack","nd","getNearest","dist","q","node0","node1","eMq","d0","d1","d2","d3","vecDot","shfs","m0","m1","m2","m3","iN","Rj","A","M","M4","tmi","multVec","sqrt","dot","sml","ia","Cov","v","roundA"],"mappings":"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","file":"UPNG.js","sourcesContent":["/*eslint-disable */\n;(function(){\nvar UPNG = {};\n\nvar pako = require('./pako.min.js');\nmodule.exports = UPNG;\n(function(UPNG, pako){\n\n\t\n\n\t\n\nUPNG.toRGBA8 = function(out)\n{\n\tvar w = out.width, h = out.height;\n\tif(out.tabs.acTL==null) return [UPNG.toRGBA8.decodeImage(out.data, w, h, out).buffer];\n\t\n\tvar frms = [];\n\tif(out.frames[0].data==null) out.frames[0].data = out.data;\n\t\n\tvar img, empty = new Uint8Array(w*h*4);\n\tfor(var i=0; i<out.frames.length; i++)\n\t{\n\t\tvar frm = out.frames[i];\n\t\tvar fx=frm.rect.x, fy=frm.rect.y, fw = frm.rect.width, fh = frm.rect.height;\n\t\tvar fdata = UPNG.toRGBA8.decodeImage(frm.data, fw,fh, out);\n\t\t\n\t\tif(i==0) img = fdata;\n\t\telse if(frm.blend  ==0) UPNG._copyTile(fdata, fw, fh, img, w, h, fx, fy, 0);\n\t\telse if(frm.blend  ==1) UPNG._copyTile(fdata, fw, fh, img, w, h, fx, fy, 1);\n\t\t\n\t\tfrms.push(img.buffer);  img = img.slice(0);\n\t\t\n\t\tif     (frm.dispose==0) {}\n\t\telse if(frm.dispose==1) UPNG._copyTile(empty, fw, fh, img, w, h, fx, fy, 0);\n\t\telse if(frm.dispose==2) {\n\t\t\tvar pi = i-1;\n\t\t\twhile(out.frames[pi].dispose==2) pi--;\n\t\t\timg = new Uint8Array(frms[pi]).slice(0);\n\t\t}\n\t}\n\treturn frms;\n}\nUPNG.toRGBA8.decodeImage = function(data, w, h, out)\n{\n\tvar area = w*h, bpp = UPNG.decode._getBPP(out);\n\tvar bpl = Math.ceil(w*bpp/8);\t// bytes per line\n\n\tvar bf = new Uint8Array(area*4), bf32 = new Uint32Array(bf.buffer);\n\tvar ctype = out.ctype, depth = out.depth;\n\tvar rs = UPNG._bin.readUshort;\n\t\n\t//console.log(ctype, depth);\n\n\tif     (ctype==6) { // RGB + alpha\n\t\tvar qarea = area<<2;\n\t\tif(depth== 8) for(var i=0; i<qarea;i++) {  bf[i] = data[i];  /*if((i&3)==3 && data[i]!=0) bf[i]=255;*/ }\n\t\tif(depth==16) for(var i=0; i<qarea;i++) {  bf[i] = data[i<<1];  }\n\t}\n\telse if(ctype==2) {\t// RGB\n\t\tvar ts=out.tabs[\"tRNS\"], tr=-1, tg=-1, tb=-1;\n\t\tif(ts) {  tr=ts[0];  tg=ts[1];  tb=ts[2];  }\n\t\tif(depth== 8) for(var i=0; i<area; i++) {  var qi=i<<2, ti=i*3;  bf[qi] = data[ti];  bf[qi+1] = data[ti+1];  bf[qi+2] = data[ti+2];  bf[qi+3] = 255;\n\t\t\tif(tr!=-1 && data[ti]   ==tr && data[ti+1]   ==tg && data[ti+2]   ==tb) bf[qi+3] = 0;  }\n\t\tif(depth==16) for(var i=0; i<area; i++) {  var qi=i<<2, ti=i*6;  bf[qi] = data[ti];  bf[qi+1] = data[ti+2];  bf[qi+2] = data[ti+4];  bf[qi+3] = 255;\n\t\t\tif(tr!=-1 && rs(data,ti)==tr && rs(data,ti+2)==tg && rs(data,ti+4)==tb) bf[qi+3] = 0;  }\n\t}\n\telse if(ctype==3) {\t// palette\n\t\tvar p=out.tabs[\"PLTE\"], ap=out.tabs[\"tRNS\"], tl=ap?ap.length:0;\n\t\t//console.log(p, ap);\n\t\tif(depth==1) for(var y=0; y<h; y++) {  var s0 = y*bpl, t0 = y*w;\n\t\t\tfor(var i=0; i<w; i++) { var qi=(t0+i)<<2, j=((data[s0+(i>>3)]>>(7-((i&7)<<0)))& 1), cj=3*j;  bf[qi]=p[cj];  bf[qi+1]=p[cj+1];  bf[qi+2]=p[cj+2];  bf[qi+3]=(j<tl)?ap[j]:255;  }\n\t\t}\n\t\tif(depth==2) for(var y=0; y<h; y++) {  var s0 = y*bpl, t0 = y*w;\n\t\t\tfor(var i=0; i<w; i++) { var qi=(t0+i)<<2, j=((data[s0+(i>>2)]>>(6-((i&3)<<1)))& 3), cj=3*j;  bf[qi]=p[cj];  bf[qi+1]=p[cj+1];  bf[qi+2]=p[cj+2];  bf[qi+3]=(j<tl)?ap[j]:255;  }\n\t\t}\n\t\tif(depth==4) for(var y=0; y<h; y++) {  var s0 = y*bpl, t0 = y*w;\n\t\t\tfor(var i=0; i<w; i++) { var qi=(t0+i)<<2, j=((data[s0+(i>>1)]>>(4-((i&1)<<2)))&15), cj=3*j;  bf[qi]=p[cj];  bf[qi+1]=p[cj+1];  bf[qi+2]=p[cj+2];  bf[qi+3]=(j<tl)?ap[j]:255;  }\n\t\t}\n\t\tif(depth==8) for(var i=0; i<area; i++ ) {  var qi=i<<2, j=data[i]                      , cj=3*j;  bf[qi]=p[cj];  bf[qi+1]=p[cj+1];  bf[qi+2]=p[cj+2];  bf[qi+3]=(j<tl)?ap[j]:255;  }\n\t}\n\telse if(ctype==4) {\t// gray + alpha\n\t\tif(depth== 8)  for(var i=0; i<area; i++) {  var qi=i<<2, di=i<<1, gr=data[di];  bf[qi]=gr;  bf[qi+1]=gr;  bf[qi+2]=gr;  bf[qi+3]=data[di+1];  }\n\t\tif(depth==16)  for(var i=0; i<area; i++) {  var qi=i<<2, di=i<<2, gr=data[di];  bf[qi]=gr;  bf[qi+1]=gr;  bf[qi+2]=gr;  bf[qi+3]=data[di+2];  }\n\t}\n\telse if(ctype==0) {\t// gray\n\t\tvar tr = out.tabs[\"tRNS\"] ? out.tabs[\"tRNS\"] : -1;\n\t\tif(depth== 1) for(var i=0; i<area; i++) {  var gr=255*((data[i>>3]>>(7 -((i&7)   )))& 1), al=(gr==tr*255)?0:255;  bf32[i]=(al<<24)|(gr<<16)|(gr<<8)|gr;  }\n\t\tif(depth== 2) for(var i=0; i<area; i++) {  var gr= 85*((data[i>>2]>>(6 -((i&3)<<1)))& 3), al=(gr==tr* 85)?0:255;  bf32[i]=(al<<24)|(gr<<16)|(gr<<8)|gr;  }\n\t\tif(depth== 4) for(var i=0; i<area; i++) {  var gr= 17*((data[i>>1]>>(4 -((i&1)<<2)))&15), al=(gr==tr* 17)?0:255;  bf32[i]=(al<<24)|(gr<<16)|(gr<<8)|gr;  }\n\t\tif(depth== 8) for(var i=0; i<area; i++) {  var gr=data[i  ] , al=(gr           ==tr)?0:255;  bf32[i]=(al<<24)|(gr<<16)|(gr<<8)|gr;  }\n\t\tif(depth==16) for(var i=0; i<area; i++) {  var gr=data[i<<1], al=(rs(data,i<<1)==tr)?0:255;  bf32[i]=(al<<24)|(gr<<16)|(gr<<8)|gr;  }\n\t}\n\treturn bf;\n}\n\n\n\nUPNG.decode = function(buff)\n{\n\tvar data = new Uint8Array(buff), offset = 8, bin = UPNG._bin, rUs = bin.readUshort, rUi = bin.readUint;\n\tvar out = {tabs:{}, frames:[]};\n\tvar dd = new Uint8Array(data.length), doff = 0;\t // put all IDAT data into it\n\tvar fd, foff = 0;\t// frames\n\t\n\tvar mgck = [0x89, 0x50, 0x4e, 0x47, 0x0d, 0x0a, 0x1a, 0x0a];\n\tfor(var i=0; i<8; i++) if(data[i]!=mgck[i]) throw \"The input is not a PNG file!\";\n\n\twhile(offset<data.length)\n\t{\n\t\tvar len  = bin.readUint(data, offset);  offset += 4;\n\t\tvar type = bin.readASCII(data, offset, 4);  offset += 4;\n\t\t//log(type,len);\n\t\t\n\t\tif     (type==\"IHDR\")  {  UPNG.decode._IHDR(data, offset, out);  }\n\t\telse if(type==\"IDAT\") {\n\t\t\tfor(var i=0; i<len; i++) dd[doff+i] = data[offset+i];\n\t\t\tdoff += len;\n\t\t}\n\t\telse if(type==\"acTL\")  {\n\t\t\tout.tabs[type] = {  num_frames:rUi(data, offset), num_plays:rUi(data, offset+4)  };\n\t\t\tfd = new Uint8Array(data.length);\n\t\t}\n\t\telse if(type==\"fcTL\")  {\n\t\t\tif(foff!=0) {  var fr = out.frames[out.frames.length-1];\n\t\t\t\tfr.data = UPNG.decode._decompress(out, fd.slice(0,foff), fr.rect.width, fr.rect.height);  foff=0;\n\t\t\t}\n\t\t\tvar rct = {x:rUi(data, offset+12),y:rUi(data, offset+16),width:rUi(data, offset+4),height:rUi(data, offset+8)};\n\t\t\tvar del = rUs(data, offset+22);  del = rUs(data, offset+20) / (del==0?100:del);\n\t\t\tvar frm = {rect:rct, delay:Math.round(del*1000), dispose:data[offset+24], blend:data[offset+25]};\n\t\t\t//console.log(frm);\n\t\t\tout.frames.push(frm);\n\t\t}\n\t\telse if(type==\"fdAT\") {\n\t\t\tfor(var i=0; i<len-4; i++) fd[foff+i] = data[offset+i+4];\n\t\t\tfoff += len-4;\n\t\t}\n\t\telse if(type==\"pHYs\") {\n\t\t\tout.tabs[type] = [bin.readUint(data, offset), bin.readUint(data, offset+4), data[offset+8]];\n\t\t}\n\t\telse if(type==\"cHRM\") {\n\t\t\tout.tabs[type] = [];\n\t\t\tfor(var i=0; i<8; i++) out.tabs[type].push(bin.readUint(data, offset+i*4));\n\t\t}\n\t\telse if(type==\"tEXt\") {\n\t\t\tif(out.tabs[type]==null) out.tabs[type] = {};\n\t\t\tvar nz = bin.nextZero(data, offset);\n\t\t\tvar keyw = bin.readASCII(data, offset, nz-offset);\n\t\t\tvar text = bin.readASCII(data, nz+1, offset+len-nz-1);\n\t\t\tout.tabs[type][keyw] = text;\n\t\t}\n\t\telse if(type==\"iTXt\") {\n\t\t\tif(out.tabs[type]==null) out.tabs[type] = {};\n\t\t\tvar nz = 0, off = offset;\n\t\t\tnz = bin.nextZero(data, off);\n\t\t\tvar keyw = bin.readASCII(data, off, nz-off);  off = nz + 1;\n\t\t\tvar cflag = data[off], cmeth = data[off+1];  off+=2;\n\t\t\tnz = bin.nextZero(data, off);\n\t\t\tvar ltag = bin.readASCII(data, off, nz-off);  off = nz + 1;\n\t\t\tnz = bin.nextZero(data, off);\n\t\t\tvar tkeyw = bin.readUTF8(data, off, nz-off);  off = nz + 1;\n\t\t\tvar text  = bin.readUTF8(data, off, len-(off-offset));\n\t\t\tout.tabs[type][keyw] = text;\n\t\t}\n\t\telse if(type==\"PLTE\") {\n\t\t\tout.tabs[type] = bin.readBytes(data, offset, len);\n\t\t}\n\t\telse if(type==\"hIST\") {\n\t\t\tvar pl = out.tabs[\"PLTE\"].length/3;\n\t\t\tout.tabs[type] = [];  for(var i=0; i<pl; i++) out.tabs[type].push(rUs(data, offset+i*2));\n\t\t}\n\t\telse if(type==\"tRNS\") {\n\t\t\tif     (out.ctype==3) out.tabs[type] = bin.readBytes(data, offset, len);\n\t\t\telse if(out.ctype==0) out.tabs[type] = rUs(data, offset);\n\t\t\telse if(out.ctype==2) out.tabs[type] = [ rUs(data,offset),rUs(data,offset+2),rUs(data,offset+4) ];\n\t\t\t//else console.log(\"tRNS for unsupported color type\",out.ctype, len);\n\t\t}\n\t\telse if(type==\"gAMA\") out.tabs[type] = bin.readUint(data, offset)/100000;\n\t\telse if(type==\"sRGB\") out.tabs[type] = data[offset];\n\t\telse if(type==\"bKGD\")\n\t\t{\n\t\t\tif     (out.ctype==0 || out.ctype==4) out.tabs[type] = [rUs(data, offset)];\n\t\t\telse if(out.ctype==2 || out.ctype==6) out.tabs[type] = [rUs(data, offset), rUs(data, offset+2), rUs(data, offset+4)];\n\t\t\telse if(out.ctype==3) out.tabs[type] = data[offset];\n\t\t}\n\t\telse if(type==\"IEND\") {\n\t\t\tif(foff!=0) {  var fr = out.frames[out.frames.length-1];\n\t\t\t\tfr.data = UPNG.decode._decompress(out, fd.slice(0,foff), fr.rect.width, fr.rect.height);  foff=0;\n\t\t\t}\t\n\t\t\tout.data = UPNG.decode._decompress(out, dd, out.width, out.height);  break;\n\t\t}\n\t\t//else {  log(\"unknown chunk type\", type, len);  }\n\t\toffset += len;\n\t\tvar crc = bin.readUint(data, offset);  offset += 4;\n\t}\n\tdelete out.compress;  delete out.interlace;  delete out.filter;\n\treturn out;\n}\n\nUPNG.decode._decompress = function(out, dd, w, h) {\n\tif(out.compress ==0) dd = UPNG.decode._inflate(dd);\n\n\tif     (out.interlace==0) dd = UPNG.decode._filterZero(dd, out, 0, w, h);\n\telse if(out.interlace==1) dd = UPNG.decode._readInterlace(dd, out);\n\treturn dd;\n}\n\nUPNG.decode._inflate = function(data) {  return pako[\"inflate\"](data);  }\n\nUPNG.decode._readInterlace = function(data, out)\n{\n\tvar w = out.width, h = out.height;\n\tvar bpp = UPNG.decode._getBPP(out), cbpp = bpp>>3, bpl = Math.ceil(w*bpp/8);\n\tvar img = new Uint8Array( h * bpl );\n\tvar di = 0;\n\n\tvar starting_row  = [ 0, 0, 4, 0, 2, 0, 1 ];\n\tvar starting_col  = [ 0, 4, 0, 2, 0, 1, 0 ];\n\tvar row_increment = [ 8, 8, 8, 4, 4, 2, 2 ];\n\tvar col_increment = [ 8, 8, 4, 4, 2, 2, 1 ];\n\n\tvar pass=0;\n\twhile(pass<7)\n\t{\n\t\tvar ri = row_increment[pass], ci = col_increment[pass];\n\t\tvar sw = 0, sh = 0;\n\t\tvar cr = starting_row[pass];  while(cr<h) {  cr+=ri;  sh++;  }\n\t\tvar cc = starting_col[pass];  while(cc<w) {  cc+=ci;  sw++;  }\n\t\tvar bpll = Math.ceil(sw*bpp/8);\n\t\tUPNG.decode._filterZero(data, out, di, sw, sh);\n\n\t\tvar y=0, row = starting_row[pass];\n\t\twhile(row<h)\n\t\t{\n\t\t\tvar col = starting_col[pass];\n\t\t\tvar cdi = (di+y*bpll)<<3;\n\n\t\t\twhile(col<w)\n\t\t\t{\n\t\t\t\tif(bpp==1) {\n\t\t\t\t\tvar val = data[cdi>>3];  val = (val>>(7-(cdi&7)))&1;\n\t\t\t\t\timg[row*bpl + (col>>3)] |= (val << (7-((col&3)<<0)));\n\t\t\t\t}\n\t\t\t\tif(bpp==2) {\n\t\t\t\t\tvar val = data[cdi>>3];  val = (val>>(6-(cdi&7)))&3;\n\t\t\t\t\timg[row*bpl + (col>>2)] |= (val << (6-((col&3)<<1)));\n\t\t\t\t}\n\t\t\t\tif(bpp==4) {\n\t\t\t\t\tvar val = data[cdi>>3];  val = (val>>(4-(cdi&7)))&15;\n\t\t\t\t\timg[row*bpl + (col>>1)] |= (val << (4-((col&1)<<2)));\n\t\t\t\t}\n\t\t\t\tif(bpp>=8) {\n\t\t\t\t\tvar ii = row*bpl+col*cbpp;\n\t\t\t\t\tfor(var j=0; j<cbpp; j++) img[ii+j] = data[(cdi>>3)+j];\n\t\t\t\t}\n\t\t\t\tcdi+=bpp;  col+=ci;\n\t\t\t}\n\t\t\ty++;  row += ri;\n\t\t}\n\t\tif(sw*sh!=0) di += sh * (1 + bpll);\n\t\tpass = pass + 1;\n\t}\n\treturn img;\n}\n\nUPNG.decode._getBPP = function(out) {\n\tvar noc = [1,null,3,1,2,null,4][out.ctype];\n\treturn noc * out.depth;\n}\n\nUPNG.decode._filterZero = function(data, out, off, w, h)\n{\n\tvar bpp = UPNG.decode._getBPP(out), bpl = Math.ceil(w*bpp/8), paeth = UPNG.decode._paeth;\n\tbpp = Math.ceil(bpp/8);\n\n\tfor(var y=0; y<h; y++)  {\n\t\tvar i = off+y*bpl, di = i+y+1;\n\t\tvar type = data[di-1];\n\n\t\tif     (type==0) for(var x=  0; x<bpl; x++) data[i+x] = data[di+x];\n\t\telse if(type==1) {\n\t\t\tfor(var x=  0; x<bpp; x++) data[i+x] = data[di+x];\n\t\t\tfor(var x=bpp; x<bpl; x++) data[i+x] = (data[di+x] + data[i+x-bpp])&255;\n\t\t}\n\t\telse if(y==0) {\n\t\t\tfor(var x=  0; x<bpp; x++) data[i+x] = data[di+x];\n\t\t\tif(type==2) for(var x=bpp; x<bpl; x++) data[i+x] = (data[di+x])&255;\n\t\t\tif(type==3) for(var x=bpp; x<bpl; x++) data[i+x] = (data[di+x] + (data[i+x-bpp]>>1) )&255;\n\t\t\tif(type==4) for(var x=bpp; x<bpl; x++) data[i+x] = (data[di+x] + paeth(data[i+x-bpp], 0, 0) )&255;\n\t\t}\n\t\telse {\n\t\t\tif(type==2) { for(var x=  0; x<bpl; x++) data[i+x] = (data[di+x] + data[i+x-bpl])&255;  }\n\n\t\t\tif(type==3) { for(var x=  0; x<bpp; x++) data[i+x] = (data[di+x] + (data[i+x-bpl]>>1))&255;\n\t\t\t              for(var x=bpp; x<bpl; x++) data[i+x] = (data[di+x] + ((data[i+x-bpl]+data[i+x-bpp])>>1) )&255;  }\n\n\t\t\tif(type==4) { for(var x=  0; x<bpp; x++) data[i+x] = (data[di+x] + paeth(0, data[i+x-bpl], 0))&255;\n\t\t\t\t\t\t  for(var x=bpp; x<bpl; x++) data[i+x] = (data[di+x] + paeth(data[i+x-bpp], data[i+x-bpl], data[i+x-bpp-bpl]) )&255;  }\n\t\t}\n\t}\n\treturn data;\n}\n\nUPNG.decode._paeth = function(a,b,c)\n{\n\tvar p = a+b-c, pa = Math.abs(p-a), pb = Math.abs(p-b), pc = Math.abs(p-c);\n\tif (pa <= pb && pa <= pc)  return a;\n\telse if (pb <= pc)  return b;\n\treturn c;\n}\n\nUPNG.decode._IHDR = function(data, offset, out)\n{\n\tvar bin = UPNG._bin;\n\tout.width  = bin.readUint(data, offset);  offset += 4;\n\tout.height = bin.readUint(data, offset);  offset += 4;\n\tout.depth     = data[offset];  offset++;\n\tout.ctype     = data[offset];  offset++;\n\tout.compress  = data[offset];  offset++;\n\tout.filter    = data[offset];  offset++;\n\tout.interlace = data[offset];  offset++;\n}\n\nUPNG._bin = {\n\tnextZero   : function(data,p)  {  while(data[p]!=0) p++;  return p;  },\n\treadUshort : function(buff,p)  {  return (buff[p]<< 8) | buff[p+1];  },\n\twriteUshort: function(buff,p,n){  buff[p] = (n>>8)&255;  buff[p+1] = n&255;  },\n\treadUint   : function(buff,p)  {  return (buff[p]*(256*256*256)) + ((buff[p+1]<<16) | (buff[p+2]<< 8) | buff[p+3]);  },\n\twriteUint  : function(buff,p,n){  buff[p]=(n>>24)&255;  buff[p+1]=(n>>16)&255;  buff[p+2]=(n>>8)&255;  buff[p+3]=n&255;  },\n\treadASCII  : function(buff,p,l){  var s = \"\";  for(var i=0; i<l; i++) s += String.fromCharCode(buff[p+i]);  return s;    },\n\twriteASCII : function(data,p,s){  for(var i=0; i<s.length; i++) data[p+i] = s.charCodeAt(i);  },\n\treadBytes  : function(buff,p,l){  var arr = [];   for(var i=0; i<l; i++) arr.push(buff[p+i]);   return arr;  },\n\tpad : function(n) { return n.length < 2 ? \"0\" + n : n; },\n\treadUTF8 : function(buff, p, l) {\n\t\tvar s = \"\", ns;\n\t\tfor(var i=0; i<l; i++) s += \"%\" + UPNG._bin.pad(buff[p+i].toString(16));\n\t\ttry {  ns = decodeURIComponent(s); }\n\t\tcatch(e) {  return UPNG._bin.readASCII(buff, p, l);  }\n\t\treturn  ns;\n\t}\n}\nUPNG._copyTile = function(sb, sw, sh, tb, tw, th, xoff, yoff, mode)\n{\n\tvar w = Math.min(sw,tw), h = Math.min(sh,th);\n\tvar si=0, ti=0;\n\tfor(var y=0; y<h; y++)\n\t\tfor(var x=0; x<w; x++)\n\t\t{\n\t\t\tif(xoff>=0 && yoff>=0) {  si = (y*sw+x)<<2;  ti = (( yoff+y)*tw+xoff+x)<<2;  }\n\t\t\telse                   {  si = ((-yoff+y)*sw-xoff+x)<<2;  ti = (y*tw+x)<<2;  }\n\t\t\t\n\t\t\tif     (mode==0) {  tb[ti] = sb[si];  tb[ti+1] = sb[si+1];  tb[ti+2] = sb[si+2];  tb[ti+3] = sb[si+3];  }\n\t\t\telse if(mode==1) {\n\t\t\t\tvar fa = sb[si+3]*(1/255), fr=sb[si]*fa, fg=sb[si+1]*fa, fb=sb[si+2]*fa; \n\t\t\t\tvar ba = tb[ti+3]*(1/255), br=tb[ti]*ba, bg=tb[ti+1]*ba, bb=tb[ti+2]*ba; \n\t\t\t\t\n\t\t\t\tvar ifa=1-fa, oa = fa+ba*ifa, ioa = (oa==0?0:1/oa);\n\t\t\t\ttb[ti+3] = 255*oa;  \n\t\t\t\ttb[ti+0] = (fr+br*ifa)*ioa;  \n\t\t\t\ttb[ti+1] = (fg+bg*ifa)*ioa;   \n\t\t\t\ttb[ti+2] = (fb+bb*ifa)*ioa;  \n\t\t\t}\n\t\t\telse if(mode==2){\t// copy only differences, otherwise zero\n\t\t\t\tvar fa = sb[si+3], fr=sb[si], fg=sb[si+1], fb=sb[si+2]; \n\t\t\t\tvar ba = tb[ti+3], br=tb[ti], bg=tb[ti+1], bb=tb[ti+2]; \n\t\t\t\tif(fa==ba && fr==br && fg==bg && fb==bb) {  tb[ti]=0;  tb[ti+1]=0;  tb[ti+2]=0;  tb[ti+3]=0;  }\n\t\t\t\telse {  tb[ti]=fr;  tb[ti+1]=fg;  tb[ti+2]=fb;  tb[ti+3]=fa;  }\n\t\t\t}\n\t\t\telse if(mode==3){\t// check if can be blended\n\t\t\t\tvar fa = sb[si+3], fr=sb[si], fg=sb[si+1], fb=sb[si+2]; \n\t\t\t\tvar ba = tb[ti+3], br=tb[ti], bg=tb[ti+1], bb=tb[ti+2]; \n\t\t\t\tif(fa==ba && fr==br && fg==bg && fb==bb) continue;\n\t\t\t\t//if(fa!=255 && ba!=0) return false;\n\t\t\t\tif(fa<220 && ba>20) return false;\n\t\t\t}\n\t\t}\n\treturn true;\n}\n\n\n\nUPNG.encode = function(bufs, w, h, ps, dels, forbidPlte)\n{\n\tif(ps==null) ps=0;\n\tif(forbidPlte==null) forbidPlte = false;\n\tvar data = new Uint8Array(bufs[0].byteLength*bufs.length+100);\n\tvar wr=[0x89, 0x50, 0x4e, 0x47, 0x0d, 0x0a, 0x1a, 0x0a];\n\tfor(var i=0; i<8; i++) data[i]=wr[i];\n\tvar offset = 8,  bin = UPNG._bin, crc = UPNG.crc.crc, wUi = bin.writeUint, wUs = bin.writeUshort, wAs = bin.writeASCII;\n\n\tvar nimg = UPNG.encode.compressPNG(bufs, w, h, ps, forbidPlte);\n\n\twUi(data,offset, 13);     offset+=4;\n\twAs(data,offset,\"IHDR\");  offset+=4;\n\twUi(data,offset,w);  offset+=4;\n\twUi(data,offset,h);  offset+=4;\n\tdata[offset] = nimg.depth;  offset++;  // depth\n\tdata[offset] = nimg.ctype;  offset++;  // ctype\n\tdata[offset] = 0;  offset++;  // compress\n\tdata[offset] = 0;  offset++;  // filter\n\tdata[offset] = 0;  offset++;  // interlace\n\twUi(data,offset,crc(data,offset-17,17));  offset+=4; // crc\n\n\t// 9 bytes to say, that it is sRGB\n\twUi(data,offset, 1);      offset+=4;\n\twAs(data,offset,\"sRGB\");  offset+=4;\n\tdata[offset] = 1;  offset++;\n\twUi(data,offset,crc(data,offset-5,5));  offset+=4; // crc\n\n\tvar anim = bufs.length>1;\n\tif(anim) {\n\t\twUi(data,offset, 8);      offset+=4;\n\t\twAs(data,offset,\"acTL\");  offset+=4;\n\t\twUi(data,offset, bufs.length);      offset+=4;\n\t\twUi(data,offset, 0);      offset+=4;\n\t\twUi(data,offset,crc(data,offset-12,12));  offset+=4; // crc\n\t}\n\n\tif(nimg.ctype==3) {\n\t\tvar dl = nimg.plte.length;\n\t\twUi(data,offset, dl*3);  offset+=4;\n\t\twAs(data,offset,\"PLTE\");  offset+=4;\n\t\tfor(var i=0; i<dl; i++){\n\t\t\tvar ti=i*3, c=nimg.plte[i], r=(c)&255, g=(c>>8)&255, b=(c>>16)&255;\n\t\t\tdata[offset+ti+0]=r;  data[offset+ti+1]=g;  data[offset+ti+2]=b;\n\t\t}\n\t\toffset+=dl*3;\n\t\twUi(data,offset,crc(data,offset-dl*3-4,dl*3+4));  offset+=4; // crc\n\n\t\tif(nimg.gotAlpha) {\n\t\t\twUi(data,offset, dl);  offset+=4;\n\t\t\twAs(data,offset,\"tRNS\");  offset+=4;\n\t\t\tfor(var i=0; i<dl; i++)  data[offset+i]=(nimg.plte[i]>>24)&255;\n\t\t\toffset+=dl;\n\t\t\twUi(data,offset,crc(data,offset-dl-4,dl+4));  offset+=4; // crc\n\t\t}\n\t}\n\t\n\tvar fi = 0;\n\tfor(var j=0; j<nimg.frames.length; j++)\n\t{\n\t\tvar fr = nimg.frames[j];\n\t\tif(anim) {\n\t\t\twUi(data,offset, 26);     offset+=4;\n\t\t\twAs(data,offset,\"fcTL\");  offset+=4;\n\t\t\twUi(data, offset, fi++);   offset+=4;\n\t\t\twUi(data, offset, fr.rect.width );   offset+=4;\n\t\t\twUi(data, offset, fr.rect.height);   offset+=4;\n\t\t\twUi(data, offset, fr.rect.x);   offset+=4;\n\t\t\twUi(data, offset, fr.rect.y);   offset+=4;\n\t\t\twUs(data, offset, dels[j]);   offset+=2;\n\t\t\twUs(data, offset,  1000);   offset+=2;\n\t\t\tdata[offset] = fr.dispose;  offset++;\t// dispose\n\t\t\tdata[offset] = fr.blend  ;  offset++;\t// blend\n\t\t\twUi(data,offset,crc(data,offset-30,30));  offset+=4; // crc\n\t\t}\n\t\t\t\t\n\t\tvar imgd = fr.cimg, dl = imgd.length;\n\t\twUi(data,offset, dl+(j==0?0:4));     offset+=4;\n\t\tvar ioff = offset;\n\t\twAs(data,offset,(j==0)?\"IDAT\":\"fdAT\");  offset+=4;\n\t\tif(j!=0) {  wUi(data, offset, fi++);  offset+=4;  }\n\t\tfor(var i=0; i<dl; i++) data[offset+i] = imgd[i];\n\t\toffset += dl;\n\t\twUi(data,offset,crc(data,ioff,offset-ioff));  offset+=4; // crc\n\t}\n\n\twUi(data,offset, 0);     offset+=4;\n\twAs(data,offset,\"IEND\");  offset+=4;\n\twUi(data,offset,crc(data,offset-4,4));  offset+=4; // crc\n\n\treturn data.buffer.slice(0,offset);\n}\n\nUPNG.encode.compressPNG = function(bufs, w, h, ps, forbidPlte)\n{\n\tvar out = UPNG.encode.compress(bufs, w, h, ps, false, forbidPlte);\n\tfor(var i=0; i<bufs.length; i++) {\n\t\tvar frm = out.frames[i], nw=frm.rect.width, nh=frm.rect.height, bpl=frm.bpl, bpp=frm.bpp;\n\t\tvar fdata = new Uint8Array(nh*bpl+nh);\n\t\tfrm.cimg = UPNG.encode._filterZero(frm.img,nh,bpp,bpl,fdata);\n\t}\t\n\treturn out;\n}\n\nUPNG.encode.compress = function(bufs, w, h, ps, forGIF, forbidPlte)\n{\n\tif(forbidPlte==null) forbidPlte = false;\n\t\n\tvar ctype = 6, depth = 8, bpp = 4, alphaAnd=255\n\t\n\tfor(var j=0; j<bufs.length; j++)  {  // when not quantized, other frames can contain colors, that are not in an initial frame\n\t\tvar img = new Uint8Array(bufs[j]), ilen = img.length;\n\t\tfor(var i=0; i<ilen; i+=4) alphaAnd &= img[i+3];\n\t}\n\tvar gotAlpha = (alphaAnd)!=255;\n\t\n\tvar cmap={}, plte=[];  if(bufs.length!=0) {  cmap[0]=0;  plte.push(0);  if(ps!=0) ps--;  } \n\t\n\t\n\tif(ps!=0) {\n\t\tvar qres = UPNG.quantize(bufs, ps, forGIF);  bufs = qres.bufs;\n\t\tfor(var i=0; i<qres.plte.length; i++) {  var c=qres.plte[i].est.rgba;  if(cmap[c]==null) {  cmap[c]=plte.length;  plte.push(c);  }     }\n\t}\n\telse {\n\t\t// what if ps==0, but there are <=256 colors?  we still need to detect, if the palette could be used\n\t\tfor(var j=0; j<bufs.length; j++)  {  // when not quantized, other frames can contain colors, that are not in an initial frame\n\t\t\tvar img32 = new Uint32Array(bufs[j]), ilen = img32.length;\n\t\t\tfor(var i=0; i<ilen; i++) {\n\t\t\t\tvar c = img32[i];\n\t\t\t\tif((i<w || (c!=img32[i-1] && c!=img32[i-w])) && cmap[c]==null) {  cmap[c]=plte.length;  plte.push(c);  if(plte.length>=300) break;  }\n\t\t\t}\n\t\t}\n\t}\n\t\n\tvar brute = gotAlpha ? forGIF : false;\t\t// brute : frames can only be copied, not \"blended\"\n\tvar cc=plte.length;  //console.log(cc);\n\tif(cc<=256 && forbidPlte==false) {\n\t\tif(cc<= 2) depth=1;  else if(cc<= 4) depth=2;  else if(cc<=16) depth=4;  else depth=8;\n\t\tif(forGIF) depth=8;\n\t\tgotAlpha = true;\n\t}\n\t\n\t\n\tvar frms = [];\n\tfor(var j=0; j<bufs.length; j++)\n\t{\n\t\tvar cimg = new Uint8Array(bufs[j]), cimg32 = new Uint32Array(cimg.buffer);\n\t\t\n\t\tvar nx=0, ny=0, nw=w, nh=h, blend=0;\n\t\tif(j!=0 && !brute) {\n\t\t\tvar tlim = (forGIF || j==1 || frms[frms.length-2].dispose==2)?1:2, tstp = 0, tarea = 1e9;\n\t\t\tfor(var it=0; it<tlim; it++)\n\t\t\t{\n\t\t\t\tvar pimg = new Uint8Array(bufs[j-1-it]), p32 = new Uint32Array(bufs[j-1-it]);\n\t\t\t\tvar mix=w,miy=h,max=-1,may=-1;\n\t\t\t\tfor(var y=0; y<h; y++) for(var x=0; x<w; x++) {\n\t\t\t\t\tvar i = y*w+x;\n\t\t\t\t\tif(cimg32[i]!=p32[i]) {\n\t\t\t\t\t\tif(x<mix) mix=x;  if(x>max) max=x;\n\t\t\t\t\t\tif(y<miy) miy=y;  if(y>may) may=y;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tvar sarea = (max==-1) ? 1 : (max-mix+1)*(may-miy+1);\n\t\t\t\tif(sarea<tarea) {\n\t\t\t\t\ttarea = sarea;  tstp = it;  \n\t\t\t\t\tif(max==-1) {  nx=ny=0;  nw=nh=1;  }\n\t\t\t\t\telse {  nx = mix; ny = miy; nw = max-mix+1; nh = may-miy+1;  }\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t\tvar pimg = new Uint8Array(bufs[j-1-tstp]);\n\t\t\tif(tstp==1) frms[frms.length-1].dispose = 2;\n\t\t\t\n\t\t\tvar nimg = new Uint8Array(nw*nh*4), nimg32 = new Uint32Array(nimg.buffer);\n\t\t\tUPNG.   _copyTile(pimg,w,h, nimg,nw,nh, -nx,-ny, 0);\n\t\t\tif(UPNG._copyTile(cimg,w,h, nimg,nw,nh, -nx,-ny, 3)) {\n\t\t\t\tUPNG._copyTile(cimg,w,h, nimg,nw,nh, -nx,-ny, 2);  blend = 1;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tUPNG._copyTile(cimg,w,h, nimg,nw,nh, -nx,-ny, 0);  blend = 0;\n\t\t\t}\n\t\t\tcimg = nimg;  cimg32 = new Uint32Array(cimg.buffer);\n\t\t}\n\t\tvar bpl = 4*nw;\n\t\tif(cc<=256 && forbidPlte==false) {\n\t\t\tbpl = Math.ceil(depth*nw/8);\n\t\t\tvar nimg = new Uint8Array(bpl*nh);\n\t\t\tfor(var y=0; y<nh; y++) {  var i=y*bpl, ii=y*nw;\n\t\t\t\tif     (depth==8) for(var x=0; x<nw; x++) nimg[i+(x)   ]   =  (cmap[cimg32[ii+x]]             );\n\t\t\t\telse if(depth==4) for(var x=0; x<nw; x++) nimg[i+(x>>1)]  |=  (cmap[cimg32[ii+x]]<<(4-(x&1)*4));\n\t\t\t\telse if(depth==2) for(var x=0; x<nw; x++) nimg[i+(x>>2)]  |=  (cmap[cimg32[ii+x]]<<(6-(x&3)*2));\n\t\t\t\telse if(depth==1) for(var x=0; x<nw; x++) nimg[i+(x>>3)]  |=  (cmap[cimg32[ii+x]]<<(7-(x&7)*1));\n\t\t\t}\n\t\t\tcimg=nimg;  ctype=3;  bpp=1;\n\t\t}\n\t\telse if(gotAlpha==false && bufs.length==1) {\t// some next \"reduced\" frames may contain alpha for blending\n\t\t\tvar nimg = new Uint8Array(nw*nh*3), area=nw*nh;\n\t\t\tfor(var i=0; i<area; i++) { var ti=i*3, qi=i*4;  nimg[ti]=cimg[qi];  nimg[ti+1]=cimg[qi+1];  nimg[ti+2]=cimg[qi+2];  }\n\t\t\tcimg=nimg;  ctype=2;  bpp=3;  bpl=3*nw;\n\t\t}\n\t\tfrms.push({rect:{x:nx,y:ny,width:nw,height:nh}, img:cimg, bpl:bpl, bpp:bpp, blend:blend, dispose:brute?1:0});\n\t}\n\treturn {ctype:ctype, depth:depth, plte:plte, gotAlpha:gotAlpha, frames:frms  };\n}\n\nUPNG.encode._filterZero = function(img,h,bpp,bpl,data)\n{\n\tvar fls = [];\n\tfor(var t=0; t<5; t++) {  if(h*bpl>500000 && (t==2 || t==3 || t==4)) continue;\n\t\tfor(var y=0; y<h; y++) UPNG.encode._filterLine(data, img, y, bpl, bpp, t);\n\t\tfls.push(pako[\"deflate\"](data));  if(bpp==1) break;\n\t}\n\tvar ti, tsize=1e9;\n\tfor(var i=0; i<fls.length; i++) if(fls[i].length<tsize) {  ti=i;  tsize=fls[i].length;  }\n\treturn fls[ti];\n}\nUPNG.encode._filterLine = function(data, img, y, bpl, bpp, type)\n{\n\tvar i = y*bpl, di = i+y, paeth = UPNG.decode._paeth\n\tdata[di]=type;  di++;\n\n\tif(type==0) for(var x=0; x<bpl; x++) data[di+x] = img[i+x];\n\telse if(type==1) {\n\t\tfor(var x=  0; x<bpp; x++) data[di+x] =  img[i+x];\n\t\tfor(var x=bpp; x<bpl; x++) data[di+x] = (img[i+x]-img[i+x-bpp]+256)&255;\n\t}\n\telse if(y==0) {\n\t\tfor(var x=  0; x<bpp; x++) data[di+x] = img[i+x];\n\n\t\tif(type==2) for(var x=bpp; x<bpl; x++) data[di+x] = img[i+x];\n\t\tif(type==3) for(var x=bpp; x<bpl; x++) data[di+x] = (img[i+x] - (img[i+x-bpp]>>1) +256)&255;\n\t\tif(type==4) for(var x=bpp; x<bpl; x++) data[di+x] = (img[i+x] - paeth(img[i+x-bpp], 0, 0) +256)&255;\n\t}\n\telse {\n\t\tif(type==2) { for(var x=  0; x<bpl; x++) data[di+x] = (img[i+x]+256 - img[i+x-bpl])&255;  }\n\t\tif(type==3) { for(var x=  0; x<bpp; x++) data[di+x] = (img[i+x]+256 - (img[i+x-bpl]>>1))&255;\n\t\t\t\t\t  for(var x=bpp; x<bpl; x++) data[di+x] = (img[i+x]+256 - ((img[i+x-bpl]+img[i+x-bpp])>>1))&255;  }\n\t\tif(type==4) { for(var x=  0; x<bpp; x++) data[di+x] = (img[i+x]+256 - paeth(0, img[i+x-bpl], 0))&255;\n\t\t\t\t\t  for(var x=bpp; x<bpl; x++) data[di+x] = (img[i+x]+256 - paeth(img[i+x-bpp], img[i+x-bpl], img[i+x-bpp-bpl]))&255;  }\n\t}\n}\n\nUPNG.crc = {\n\ttable : ( function() {\n\t   var tab = new Uint32Array(256);\n\t   for (var n=0; n<256; n++) {\n\t\t\tvar c = n;\n\t\t\tfor (var k=0; k<8; k++) {\n\t\t\t\tif (c & 1)  c = 0xedb88320 ^ (c >>> 1);\n\t\t\t\telse        c = c >>> 1;\n\t\t\t}\n\t\t\ttab[n] = c;  }\n\t\treturn tab;  })(),\n\tupdate : function(c, buf, off, len) {\n\t\tfor (var i=0; i<len; i++)  c = UPNG.crc.table[(c ^ buf[off+i]) & 0xff] ^ (c >>> 8);\n\t\treturn c;\n\t},\n\tcrc : function(b,o,l)  {  return UPNG.crc.update(0xffffffff,b,o,l) ^ 0xffffffff;  }\n}\n\n\nUPNG.quantize = function(bufs, ps, roundAlpha)\n{\t\n\tvar imgs = [], totl = 0;\n\tfor(var i=0; i<bufs.length; i++) {  imgs.push(UPNG.encode.alphaMul(new Uint8Array(bufs[i]), roundAlpha));  totl+=bufs[i].byteLength;  }\n\t\n\tvar nimg = new Uint8Array(totl), nimg32 = new Uint32Array(nimg.buffer), noff=0;\n\tfor(var i=0; i<imgs.length; i++) {\n\t\tvar img = imgs[i], il = img.length;\n\t\tfor(var j=0; j<il; j++) nimg[noff+j] = img[j];\n\t\tnoff += il;\n\t}\n\t\n\tvar root = {i0:0, i1:nimg.length, bst:null, est:null, tdst:0, left:null, right:null };  // basic statistic, extra statistic\n\troot.bst = UPNG.quantize.stats(  nimg,root.i0, root.i1  );  root.est = UPNG.quantize.estats( root.bst );\n\tvar leafs = [root];\n\t\n\twhile(leafs.length<ps)\n\t{\n\t\tvar maxL = 0, mi=0;\n\t\tfor(var i=0; i<leafs.length; i++) if(leafs[i].est.L > maxL) {  maxL=leafs[i].est.L;  mi=i;  }\n\t\tif(maxL<1e-3) break;\n\t\tvar node = leafs[mi];\n\t\t\n\t\tvar s0 = UPNG.quantize.splitPixels(nimg,nimg32, node.i0, node.i1, node.est.e, node.est.eMq255);\n\t\t\n\t\tvar ln = {i0:node.i0, i1:s0, bst:null, est:null, tdst:0, left:null, right:null };  ln.bst = UPNG.quantize.stats( nimg, ln.i0, ln.i1 );  \n\t\tln.est = UPNG.quantize.estats( ln.bst );\n\t\tvar rn = {i0:s0, i1:node.i1, bst:null, est:null, tdst:0, left:null, right:null };  rn.bst = {R:[], m:[], N:node.bst.N-ln.bst.N};\n\t\tfor(var i=0; i<16; i++) rn.bst.R[i] = node.bst.R[i]-ln.bst.R[i];\n\t\tfor(var i=0; i< 4; i++) rn.bst.m[i] = node.bst.m[i]-ln.bst.m[i];\n\t\trn.est = UPNG.quantize.estats( rn.bst );\n\t\t\n\t\tnode.left = ln;  node.right = rn;\n\t\tleafs[mi]=ln;  leafs.push(rn);\n\t}\n\tleafs.sort(function(a,b) {  return b.bst.N-a.bst.N;  });\n\t\n\tfor(var ii=0; ii<imgs.length; ii++) {\n\t\tvar planeDst = UPNG.quantize.planeDst;\n\t\tvar sb = new Uint8Array(imgs[ii].buffer), tb = new Uint32Array(imgs[ii].buffer), len = sb.length;\n\t\t\n\t\tvar stack = [], si=0;\n\t\tfor(var i=0; i<len; i+=4) {\n\t\t\tvar r=sb[i]*(1/255), g=sb[i+1]*(1/255), b=sb[i+2]*(1/255), a=sb[i+3]*(1/255);\n\t\t\t\n\t\t\t//  exact, but too slow :(\n\t\t\t//var nd = UPNG.quantize.getNearest(root, r, g, b, a);\n\t\t\tvar nd = root;\n\t\t\twhile(nd.left) nd = (planeDst(nd.est,r,g,b,a)<=0) ? nd.left : nd.right;\n\t\t\t\n\t\t\ttb[i>>2] = nd.est.rgba;\n\t\t}\n\t\timgs[ii]=tb.buffer;\n\t}\n\treturn {  bufs:imgs, plte:leafs  };\n}\nUPNG.quantize.getNearest = function(nd, r,g,b,a)\n{\n\tif(nd.left==null) {  nd.tdst = UPNG.quantize.dist(nd.est.q,r,g,b,a);  return nd;  }\n\tvar planeDst = UPNG.quantize.planeDst(nd.est,r,g,b,a);\n\t\n\tvar node0 = nd.left, node1 = nd.right;\n\tif(planeDst>0) {  node0=nd.right;  node1=nd.left;  }\n\t\n\tvar ln = UPNG.quantize.getNearest(node0, r,g,b,a);\n\tif(ln.tdst<=planeDst*planeDst) return ln;\n\tvar rn = UPNG.quantize.getNearest(node1, r,g,b,a);\n\treturn rn.tdst<ln.tdst ? rn : ln;\n}\nUPNG.quantize.planeDst = function(est, r,g,b,a) {  var e = est.e;  return e[0]*r + e[1]*g + e[2]*b + e[3]*a - est.eMq;  }\nUPNG.quantize.dist     = function(q,   r,g,b,a) {  var d0=r-q[0], d1=g-q[1], d2=b-q[2], d3=a-q[3];  return d0*d0+d1*d1+d2*d2+d3*d3;  }\n\nUPNG.quantize.splitPixels = function(nimg, nimg32, i0, i1, e, eMq)\n{\n\tvar vecDot = UPNG.quantize.vecDot;\n\ti1-=4;\n\tvar shfs = 0;\n\twhile(i0<i1)\n\t{\n\t\twhile(vecDot(nimg, i0, e)<=eMq) i0+=4;\n\t\twhile(vecDot(nimg, i1, e)> eMq) i1-=4;\n\t\tif(i0>=i1) break;\n\t\t\n\t\tvar t = nimg32[i0>>2];  nimg32[i0>>2] = nimg32[i1>>2];  nimg32[i1>>2]=t;\n\t\t\n\t\ti0+=4;  i1-=4;\n\t}\n\twhile(vecDot(nimg, i0, e)>eMq) i0-=4;\n\treturn i0+4;\n}\nUPNG.quantize.vecDot = function(nimg, i, e)\n{\n\treturn nimg[i]*e[0] + nimg[i+1]*e[1] + nimg[i+2]*e[2] + nimg[i+3]*e[3];\n}\nUPNG.quantize.stats = function(nimg, i0, i1){\n\tvar R = [0,0,0,0,  0,0,0,0,  0,0,0,0,  0,0,0,0];\n\tvar m = [0,0,0,0];\n\tvar N = (i1-i0)>>2;\n\tfor(var i=i0; i<i1; i+=4)\n\t{\n\t\tvar r = nimg[i]*(1/255), g = nimg[i+1]*(1/255), b = nimg[i+2]*(1/255), a = nimg[i+3]*(1/255);\n\t\t//var r = nimg[i], g = nimg[i+1], b = nimg[i+2], a = nimg[i+3];\n\t\tm[0]+=r;  m[1]+=g;  m[2]+=b;  m[3]+=a;\n\t\t\n\t\tR[ 0] += r*r;  R[ 1] += r*g;  R[ 2] += r*b;  R[ 3] += r*a;  \n\t\t               R[ 5] += g*g;  R[ 6] += g*b;  R[ 7] += g*a; \n\t\t                              R[10] += b*b;  R[11] += b*a;  \n\t\t                                             R[15] += a*a;  \n\t}\n\tR[4]=R[1];  R[8]=R[2];  R[12]=R[3];  R[9]=R[6];  R[13]=R[7];  R[14]=R[11];\n\t\n\treturn {R:R, m:m, N:N};\n}\nUPNG.quantize.estats = function(stats){\n\tvar R = stats.R, m = stats.m, N = stats.N;\n\t\n\tvar m0 = m[0], m1 = m[1], m2 = m[2], m3 = m[3], iN = (N==0 ? 0 : 1/N);\n\tvar Rj = [\n\t\tR[ 0] - m0*m0*iN,  R[ 1] - m0*m1*iN,  R[ 2] - m0*m2*iN,  R[ 3] - m0*m3*iN,  \n\t\tR[ 4] - m1*m0*iN,  R[ 5] - m1*m1*iN,  R[ 6] - m1*m2*iN,  R[ 7] - m1*m3*iN,\n\t\tR[ 8] - m2*m0*iN,  R[ 9] - m2*m1*iN,  R[10] - m2*m2*iN,  R[11] - m2*m3*iN,  \n\t\tR[12] - m3*m0*iN,  R[13] - m3*m1*iN,  R[14] - m3*m2*iN,  R[15] - m3*m3*iN \n\t];\n\t\n\tvar A = Rj, M = UPNG.M4;\n\tvar b = [0.5,0.5,0.5,0.5], mi = 0, tmi = 0;\n\t\n\tif(N!=0)\n\tfor(var i=0; i<10; i++) {\n\t\tb = M.multVec(A, b);  tmi = Math.sqrt(M.dot(b,b));  b = M.sml(1/tmi,  b);\n\t\tif(Math.abs(tmi-mi)<1e-9) break;  mi = tmi;\n\t}\t\n\t//b = [0,0,1,0];  mi=N;\n\tvar q = [m0*iN, m1*iN, m2*iN, m3*iN];\n\tvar eMq255 = M.dot(M.sml(255,q),b);\n\t\n\tvar ia = (q[3]<0.001) ? 0 : 1/q[3];\n\t\n\treturn {  Cov:Rj, q:q, e:b, L:mi,  eMq255:eMq255, eMq : M.dot(b,q),\n\t\t\t\trgba: (((Math.round(255*q[3])<<24) | (Math.round(255*q[2]*ia)<<16) |  (Math.round(255*q[1]*ia)<<8) | (Math.round(255*q[0]*ia)<<0))>>>0)  };\n}\nUPNG.M4 = {\n\tmultVec : function(m,v) {\n\t\t\treturn [\n\t\t\t\tm[ 0]*v[0] + m[ 1]*v[1] + m[ 2]*v[2] + m[ 3]*v[3],\n\t\t\t\tm[ 4]*v[0] + m[ 5]*v[1] + m[ 6]*v[2] + m[ 7]*v[3],\n\t\t\t\tm[ 8]*v[0] + m[ 9]*v[1] + m[10]*v[2] + m[11]*v[3],\n\t\t\t\tm[12]*v[0] + m[13]*v[1] + m[14]*v[2] + m[15]*v[3]\n\t\t\t];\n\t},\n\tdot : function(x,y) {  return  x[0]*y[0]+x[1]*y[1]+x[2]*y[2]+x[3]*y[3];  },\n\tsml : function(a,y) {  return [a*y[0],a*y[1],a*y[2],a*y[3]];  }\n}\n\nUPNG.encode.alphaMul = function(img, roundA) {\n\tvar nimg = new Uint8Array(img.length), area = img.length>>2; \n\tfor(var i=0; i<area; i++) {\n\t\tvar qi=i<<2, ia=img[qi+3];   \n\t\tif(roundA) ia = ((ia<128))?0:255;\n\t\tvar a = ia*(1/255);\n\t\tnimg[qi+0] = img[qi+0]*a;  nimg[qi+1] = img[qi+1]*a;  nimg[qi+2] = img[qi+2]*a;  nimg[qi+3] = ia;\n\t}\n\treturn nimg;\n}\n\n\t\n\t\n\t\n\t\n\t\n\n\n})(UPNG, pako);\n})();\n\n"]}