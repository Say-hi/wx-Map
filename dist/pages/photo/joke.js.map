{"version":3,"sources":["pages/photo/joke.js"],"names":["app","getApp","md5","require","upng","app_key","app_id","Page","data","showImg","qrcode","chooseImage","that","wx","count","success","res","setData","tempFilePaths","BackshowImg","getBottomList","wxrequest","url","baseDomain","console","log","bottomList","getApi","base64Img","model","params","image","nonce_str","Math","random","toString","substr","time_stamp","parseInt","Date","getTime","genRequestSign","method","header","hideLoading","ret","showToast","title","fail","sortObject","paramStr","keys","Object","idx","key","encodeURIComponent","hexMD5","toUpperCase","obj","sort","newObj","i","length","getbase64","e","showLoading","mask","createSelectorQuery","select","fields","size","setCanvas","width","height","currentTarget","dataset","exec","wdith","ctx","createCanvasContext","drawImage","draw","canvasGetImageData","canvasId","x","y","platform","getSystemInfoSync","reverseImgData","pngData","encode","buffer","base64","arrayBufferToBase64","w","h","con","j","savePhoto","shareImg","ctxW","ctxH","getImageInfo","src","XS","windowWidth","setFillStyle","fillRect","setFontSize","setTextAlign","setTextBaseline","fillText","setTimeout","canvasToTempFilePath","saveImageToPhotosAlbum","filePath","tempFilePath","icon","duration","onLoad","getSystemInfo","pixelRatio","windowHeight","onReady","onShow","onShareAppMessage","path","onHide","onUnload","onPullDownRefresh","choose","videoArr","ojbs","secondUrl","push","replace","autoplays","videoContext","createVideoContext","play","stopPullDownRefresh"],"mappings":"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","file":"joke.js","sourcesContent":["/*eslint-disable*/\n// 获取全局应用程序实例对象\nconst app = getApp()\nconst md5 = require('../../utils/wxmd5')\nconst upng = require('../../utils/UPNG.js')\nconst app_key = 'VTtsGXNXUeTqzIBX'\nconst app_id = 1106941934\n// 创建页面实例对象\nPage({\n  /**\n   * 页面的初始数据\n   */\n  data: {\n    showImg: '',\n    qrcode: '../../images/qrcode.jpg'\n  },\n  chooseImage () {\n    let that = this\n    wx.chooseImage({\n      count: 1,\n      success (res) {\n        that.setData({\n          showImg: res.tempFilePaths[0],\n          BackshowImg: null\n        })\n      }\n    })\n  },\n  getBottomList () {\n    let that = this\n    app.wxrequest({\n      url: app.data.baseDomain + '/api/tuFun.json',\n      data: {},\n      success (res) {\n        console.log(res)\n        that.setData({\n          showImg: res.data[0].showImg,\n          bottomList: res.data[0].bottomList\n        })\n      }\n    })\n  },\n  // 获取腾讯AI机器视觉api\n  getApi (base64Img, model) {\n    let that = this\n    let params = {\n      app_id: app_id,\n      image: base64Img,\n      nonce_str: Math.random().toString(36).substr(2),\n      model: model || 1,\n      time_stamp: parseInt(new Date().getTime() / 1000).toString()\n    }\n    params['sign'] = this.genRequestSign(params)\n    // console.log(params);\n    app.wxrequest({\n      url: 'https://api.ai.qq.com/fcgi-bin/ptu/ptu_facemerge',\n      method: 'POST',\n      header: 'application/x-www-form-urlencoded',\n      data: params,\n      success (res) {\n        wx.hideLoading()\n        if (res.data.ret != 0) {\n          return wx.showToast({\n            title: '酷到无法识别'\n          })\n        }\n        that.setData({\n          BackshowImg: \"data:image/png;base64,\" + res.data.data.image\n        })\n      },\n      fail () {\n        wx.hideLoading()\n        wx.showToast({\n          title: '囧服务器崩了'\n        })\n      }\n    })\n  },\n  genRequestSign (params)  {\n    // 1. 对请求参数按字典升序排序\n    params = this.sortObject(params)\n    // 2. 拼接键值对，value部分进行URL编码\n    let paramStr = ''\n    let keys = Object.keys(params)\n    for (let idx in keys) {\n      let key = keys[idx]\n      paramStr += key + '=' + encodeURIComponent(params[key]) + '&'\n    }\n    // 3. 拼接key\n    paramStr += 'app_key=' + app_key\n    // 4. md5\n    return md5.hexMD5(paramStr).toUpperCase()\n  },\n  sortObject (obj)  {\n    var keys = Object.keys(obj).sort()\n    var newObj = {}\n    for (var i = 0; i < keys.length; i++) {\n      newObj[keys[i]] = obj[keys[i]]\n    }\n    return newObj\n  },\n\n  getbase64 (e) {\n    wx.showLoading({\n      title: '努力转换中',\n      mask: true\n    })\n    let that = this\n    wx.createSelectorQuery().select('#showImg').fields({\n      size: true\n    }, function (res) {\n      that.setCanvas(res.width, res.height, e.currentTarget.dataset.model)\n    }).exec()\n  },\n\n  setCanvas (wdith, height, model) {\n    let that = this\n    this.setData({\n      wdith,\n      height\n    })\n    let ctx = wx.createCanvasContext('myCanvas')\n    ctx.drawImage(this.data.showImg, 0, 0, wdith, height)\n    ctx.draw(false, () => {  // 基础库版本需在1.9.0以上\n      wx.canvasGetImageData({\n        canvasId: 'myCanvas',\n        x: 0,\n        y: 0,\n        width: wdith,\n        height: height,\n        success(res) {\n          let platform = wx.getSystemInfoSync().platform\n          if (platform == 'ios') {// 兼容处理：ios获取的图片上下颠倒\n            res = that.reverseImgData(res)\n          }// 3. png编码\n          let pngData = upng.encode([res.data.buffer], res.width, res.height)\n          // 4. base64编码\n          let base64 = wx.arrayBufferToBase64(pngData)\n          that.getApi(base64, model)\n        }\n      })\n    })\n  },\n  reverseImgData(res) {\n    var w = res.width\n    var h = res.height\n    let con = 0\n    for (var i = 0; i < h / 2; i++) {\n      for (var j = 0; j < w * 4; j++) {\n        con = res.data[i * w * 4 + j]\n        res.data[i * w * 4 + j] = res.data[(h - i - 1) * w * 4 + j]\n        res.data[(h - i - 1) * w * 4 + j] = con\n      }\n    }\n    return res\n  },\n  savePhoto () {\n    let that = this\n    wx.createSelectorQuery().select('#showImg').fields({\n      size: true\n    }, function (res) {\n      that.shareImg(res.width, res.height)\n    }).exec()\n  },\n  // 绘图分享图片\n  shareImg (ctxW, ctxH) {\n    let that = this\n    wx.getImageInfo({\n      src: that.data.BackshowImg,\n      success (res) {\n        console.log(res)\n      }\n    })\n    let ctx = wx.createCanvasContext('myCanvas')\n    let XS = that.data.windowWidth / 375\n    ctx.setFillStyle('#ffffff')\n    ctx.fillRect(0, 0, ctxW, ctxH)\n    ctx.drawImage(that.data.BackshowImg, 0, 0, ctxW, ctxH)\n    ctx.setFontSize(14 * XS)\n    ctx.setFillStyle('#999999')\n    ctx.setTextAlign('right')\n    ctx.setTextBaseline('middle')\n    ctx.fillText('长按识别小程序码访问', ctxW / 2 - 90 * XS, 170 * XS + 100)\n    ctx.drawImage(that.data.qrcode, ctxW - 40, ctxH - 40, 40, 40)\n    ctx.draw()\n    setTimeout(() => {\n      wx.canvasToTempFilePath({\n        canvasId: 'myCanvas',\n        success: function (res) {\n          wx.saveImageToPhotosAlbum({\n            filePath: res.tempFilePath,\n            success () {\n              wx.showToast({\n                title: '图片保存成功',\n                icon: 'success',\n                duration: 2000\n              })\n            }\n          })\n        }\n      })\n    }, 200)\n  },\n  /**\n   * 生命周期函数--监听页面加载\n   */\n  onLoad () {\n    // TODO: onLoad\n    let that = this\n    wx.getSystemInfo({\n      success: function (res) {\n        that.setData({\n          pixelRatio: res.pixelRatio,\n          windowWidth: res.windowWidth,\n          windowHeight: res.windowHeight\n        })\n      }\n    })\n    this.getBottomList()\n    // this.getApi()\n  },\n\n  /**\n   * 生命周期函数--监听页面初次渲染完成\n   */\n  onReady () {\n    // TODO: onReady\n  },\n\n  /**\n   * 生命周期函数--监听页面显示\n   */\n  onShow () {\n    // TODO: onShow\n  },\n  onShareAppMessage: function onShareAppMessage() {\n    return {\n      title: '图FUN',\n      path: '/pages/index/index',\n      success: function success(res) {\n        // 分享成功\n      },\n      fail: function fail(res) {\n        // 分享失败\n      }\n    };\n  },\n  /**\n   * 生命周期函数--监听页面隐藏\n   */\n  onHide () {\n    // TODO: onHide\n  },\n\n  /**\n   * 生命周期函数--监听页面卸载\n   */\n  onUnload () {\n    // TODO: onUnload\n  },\n\n  /**\n   * 页面相关事件处理函数--监听用户下拉动作\n   */\n  onPullDownRefresh () {\n    // TODO: onPullDownRefresh\n    let that = this\n    let choose = this.data.choose\n    if (choose === this.data.videoArr.length) {\n      let ojbs = {\n        url: that.data.secondUrl,\n        success (res) {\n          let videoArr = []\n          for (let i of res.data.data.data) {\n            // console.log(i['group']['480p_video']['url_list'][0])\n            videoArr.push(i['group']['480p_video']['url_list'][0]['url'].replace('http://', 'https://'))\n          }\n          // let videoArr = res.data.data.data\n          that.setData({\n            choose: 0,\n            videoArr: videoArr\n          })\n        }\n      }\n      app.wxrequest(ojbs)\n    } else {\n      ++choose\n      this.setData({\n        choose: choose\n      })\n    }\n    this.setData({\n      autoplays: true\n    })\n    this.videoContext = wx.createVideoContext('videos')\n    setTimeout(function () {\n      that.videoContext.play()\n      wx.stopPullDownRefresh()\n    }, 200)\n  }\n})\n"]}