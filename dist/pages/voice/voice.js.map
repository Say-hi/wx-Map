{"version":3,"sources":["pages/voice/voice.js"],"names":["app","getApp","backgroundAudioManager","wx","getBackgroundAudioManager","timer","Page","data","basedomain","contactdomain","active","page","playStatus","animationData","showImg","listArr","play","e","currentTarget","dataset","index","PausePlay","setData","bText","name","image","playMusic","setAnimation","clearInterval","width1","width2","that","setTimeout","createSelectorQuery","select","fields","size","res","width","res2","duration","console","log","animation2","createAnimation","timingFunction","animation","translateX","step","export","setInterval","exec","control","aaa","type","showToast","title","icon","length","playBackgroundAudio","dataUrl","music","coverImgUrl","pause","stop","getData","wxrequest","url","success","hideLoading","src","previewImage","current","urls","onStopFunction","s","onLoad","onBackgroundAudioStop","onReady","onShow","onHide","onUnload","onPullDownRefresh"],"mappings":"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","file":"voice.js","sourcesContent":["// 获取全局应用程序实例对象\nconst app = getApp()\nconst backgroundAudioManager = wx.getBackgroundAudioManager()\nlet timer = null\n// 创建页面实例对象\nPage({\n  /**\n   * 页面的初始数据\n   */\n  data: {\n    basedomain: app.data.basedomain,\n    contactdomain: app.data.contactdomain,\n    active: -1,\n    page: 0,\n    playStatus: false,\n    animationData: {},\n    showImg: '',\n    listArr: []\n  },\n  play (e) {\n    if (e.currentTarget.dataset.index * 1 === this.data.active * 1) return this.PausePlay()\n    this.setData({\n      active: e.currentTarget.dataset.index,\n      playStatus: true,\n      bText: this.data.listArr[e.currentTarget.dataset.index].name,\n      showImg: this.data.listArr[e.currentTarget.dataset.index].image\n    })\n    this.playMusic()\n    this.setAnimation()\n  },\n  setAnimation () {\n    if (timer) clearInterval(timer)\n    /*eslint-disable*/\n    let width1 = 0,\n      width2 = 0,\n      that = this\n    setTimeout(() => {\n      wx.createSelectorQuery().select('.v-b-t').fields({\n        size: true\n      }, function(res){\n        width1 = res.width\n        wx.createSelectorQuery().select('.v-b-tt').fields({\n          size: true\n        }, function(res2){\n          width2 = res2.width\n          if (width2 - width1 <= 0) return that.setData({animationData: {}})\n          let duration = width2 - width1 < 100 ? 2000 : (width2 - width1) / 100 * 10000\n          if (duration > 5000) duration = 5000\n          console.log(duration)\n          let animation2 = wx.createAnimation({\n            duration: 10,\n            timingFunction: 'linear',\n          })\n          that.animation = animation2\n          animation2.translateX(0).step()\n          that.setData({\n            animationData: animation2.export()\n          })\n          let animation = wx.createAnimation({\n            duration,\n            timingFunction: 'linear',\n          })\n          that.animation = animation\n          that.setData({\n            animationData: animation.export()\n          })\n          animation.translateX(-(width2 - width1)).step().translateX(0).step()\n          that.setData({\n            animationData:animation.export()\n          })\n          timer = setInterval(() => {\n            animation.translateX(-(width2 - width1)).step().translateX(0).step()\n            that.setData({\n              animationData:animation.export()\n            })\n          }, duration * 2)\n        }).exec()\n      }).exec()\n    }, 1000)\n  },\n  control (e) {\n    let aaa = this.data.active * 1\n    if (e.currentTarget.dataset.type === 'current') {\n      this.PausePlay()\n    } else if (e.currentTarget.dataset.type === 'prev') {\n      if (aaa === 0) {\n        wx.showToast({\n          title: '没有上一首啦',\n          icon: 'none'\n        })\n        return\n      }\n      this.setData({\n        active: aaa - 1,\n        playStatus: true,\n        bText: this.data.listArr[aaa - 1].name,\n        showImg: this.data.listArr[aaa - 1].image\n      })\n\n      this.playMusic()\n      this.setAnimation()\n    } else if (e.currentTarget.dataset.type === 'next') {\n      if (aaa === this.data.listArr.length - 1) {\n        wx.showToast({\n          title: '没有下一首啦',\n          icon: 'none'\n        })\n        return\n      }\n      this.setData({\n        active: aaa + 1,\n        playStatus: true,\n        bText: this.data.listArr[aaa + 1].name,\n        showImg: this.data.listArr[aaa + 1].image\n      })\n      this.playMusic()\n      this.setAnimation()\n    }\n  },\n  // 播放\n  playMusic () {\n    let that = this\n    wx.playBackgroundAudio({\n      dataUrl: that.data.listArr[that.data.active].music,\n      title: that.data.listArr[that.data.active].name,\n      coverImgUrl: that.data.listArr[that.data.active].image\n    })\n  },\n  // 暂停/播放\n  PausePlay () {\n    this.setData({\n      playStatus: !this.data.playStatus\n    })\n    if (this.data.playStatus) backgroundAudioManager.play()\n    else backgroundAudioManager.pause()\n  },\n  // 停止\n  stop () {\n    this.setData({\n      playStatus: false,\n      active: -1\n    })\n    backgroundAudioManager.stop()\n  },\n  getData () {\n    let that = this\n    app.wxrequest({\n      url: `https://c.jiangwenqiang.com/api/music_list.json`,\n      data: {},\n      success (res) {\n        wx.hideLoading()\n        that.setData({\n          listArr: res.data\n        })\n      }\n    })\n  },\n  showImg (e) {\n    let src = e.currentTarget.dataset.src\n    wx.previewImage({\n      current: src,\n      urls: [src]\n    })\n  },\n  onStopFunction () {\n    let s = this.data.active\n    if (s >= this.data.listArr.length - 1) s = 0\n    else ++s\n    this.setData({\n      active: s,\n      bText: this.data.listArr[s].name,\n      showImg: this.data.listArr[s].image\n    })\n    this.playMusic()\n  },\n  /**\n   * 生命周期函数--监听页面加载\n   */\n  onLoad () {\n    this.getData()\n    wx.onBackgroundAudioStop(this.onStopFunction)\n    // TODO: onLoad\n  },\n  /**\n   * 生命周期函数--监听页面初次渲染完成\n   */\n  onReady () {\n    // TODO: onReady\n  },\n\n  /**\n   * 生命周期函数--监听页面显示\n   */\n  onShow () {\n    // TODO: onShow\n  },\n\n  /**\n   * 生命周期函数--监听页面隐藏\n   */\n  onHide () {\n    // TODO: onHide\n  },\n\n  /**\n   * 生命周期函数--监听页面卸载\n   */\n  onUnload () {\n    // TODO: onUnload\n  },\n\n  /**\n   * 页面相关事件处理函数--监听用户下拉动作\n   */\n  onPullDownRefresh () {\n    // TODO: onPullDownRefresh\n  }\n})\n"]}