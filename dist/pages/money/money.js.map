{"version":3,"sources":["pages/money/money.js"],"names":["Page","data","title","url2","curChoose","showFlag","first_number","itemArr","USD","img","country","moneyKind","CNY","HKD","EUR","caculateArr","rateArr","rateArr2","curIndex","choose","e","setData","currentTarget","dataset","index","flag","number","that","setTimeout","wx","showToast","image","mask","cur","money","rate","toString","split","join","caculate","indexOf","length","moneyDel","slice","scurs","moneys","scur","rateBase","itemArrUse","rateUse","rateBaseMoney","baseMoneyRate","i","ss","moneyUse","Math","round","moneyPointArr","getMoney","moneyOne","reverse","lenght","j","floor","splice","getRate","showLoading","request","url","method","success","res","hideLoading","stopPullDownRefresh","common","symbol","onLoad","onReady","onShow","onHide","onUnload","onPullDownRefresh","onShareAppMessage","path"],"mappings":"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","file":"money.js","sourcesContent":["// 获取全局应用程序实例对象\n// const app = getApp()\n\n// 创建页面实例对象\nPage({\n  /**\n   * 页面的初始数据\n   */\n  data: {\n    title: 'money',\n    // url: 'https://sapi.k780.com/?app=finance.rate',\n    // url2: 'https://www.qingsongriyu.com/currency2',\n    url2: 'https://api.bw9.org/currency2',\n    curChoose: 'xxx',\n    showFlag: false,\n    first_number: false,\n    itemArr: {\n      USD: {\n        img: '../../images/usd.png',\n        country: 'USD',\n        moneyKind: '美元/$'\n      },\n      CNY: {\n        img: '../../images/cny.png',\n        country: 'CNY',\n        moneyKind: '人民币/￥'\n      },\n      HKD: {\n        img: '../../images/hkd.png',\n        country: 'HKD',\n        moneyKind: '港币HK/￥'\n      },\n      EUR: {\n        img: '../../images/eur.png',\n        country: 'EUR',\n        moneyKind: '欧元/€'\n      }\n    },\n    caculateArr: [\n      1, 2, 3, 4, 5, 6, 7, 8, 9, '.', 0, '←'\n    ],\n    rateArr: ['USD', 'CNY', 'HKD', 'EUR'],\n    rateArr2: [],\n    curIndex: 99\n  },\n  // touchStart (e) {\n  //   this.setData({\n  //     curIndex: e.currentTarget.dataset.index\n  //   })\n  // },\n  // touchEnd () {\n  //   this.setData({\n  //     curIndex: 99\n  //   })\n  // },\n  // 货币初始单位选择\n  choose (e) {\n    this.setData({\n      curChoose: e.currentTarget.dataset.index,\n      flag: true\n    })\n  },\n  // 键盘\n  number (e) {\n    let that = this\n    this.setData({\n      curIndex: e.currentTarget.dataset.index\n    })\n    setTimeout(function () {\n      that.setData({\n        curIndex: 99\n      })\n    }, 100) // 因为在我写这个的时候还没有view上的hove-class属性， 所以这里是为了实现点击阴影的效果\n    if (!this.data.flag) { // 首先判断用户是否选择了某个币种，如无退出告知用户\n      return wx.showToast({\n        title: '请选择币种',\n        image: '../../images/keai.png',\n        mask: true\n      })\n    }\n    let cur = this.data.curChoose\n    let number = e.currentTarget.dataset.index * 1 + 1\n    let money = that.data.itemArr[cur].rate.toString().split(',').join('')\n    // 第一次点击清空\n    if (!this.data.first_number) {\n      if (number < 10) {\n        that.caculate(cur, number)\n      } else if (number === 11) {\n        that.caculate(cur, '0')\n      }\n      if (!that.data.showFlag) {\n        that.setData({\n          first_number: true\n        })\n      }\n      that.setData({\n        showFlag: true\n      })\n      return\n    }\n    // 非第一次点击\n    if (money.indexOf('.') > 0 && number !== 12) {\n      if (money.indexOf('.') + 2 === money.length - 1) {\n        return wx.showToast({\n          title: '不能有比分更小的啦',\n          image: '../../images/hi_HL.png',\n          mask: true\n        })\n      }\n    } else {\n      if (money.length > 12 && number !== 12) {\n        return wx.showToast({\n          title: '超出计算范围啦',\n          image: '../../images/hi_HL.png',\n          mask: true\n        })\n      }\n    }\n    if (number < 10) {\n      that.caculate(cur, (money + number) * 1)\n    } else if (number === 10) {\n      if (money.indexOf('.') < 0) {\n        that.data.itemArr[cur].rate += '.'\n        that.setData({\n          itemArr: that.data.itemArr\n        })\n      }\n    } else if (number === 11) {\n      if (money.indexOf('.') > 0) {\n        that.data.itemArr[cur].rate += '0'\n        that.setData({\n          itemArr: that.data.itemArr\n        })\n        return\n      }\n      if (money === '0') {\n        return\n      }\n      that.caculate(cur, (money + '0') * 1)\n    } else if (number === 12) {\n      let moneyDel = money.slice(0, money.length - 1)\n      if (moneyDel === '') {\n        return that.caculate(cur, '0')\n      }\n      that.caculate(cur, moneyDel * 1)\n    }\n  },\n  // 计算\n  caculate (scurs, moneys) {\n    let scur = scurs || 'CNY'\n    let money = moneys || 100\n    let that = this\n    let rateBase = this.data.itemArrUse\n    let rateUse = this.data.itemArr\n    let rateBaseMoney = rateBase[scur].rate.toString().split(',').join('') * 1\n    let baseMoneyRate = money / (rateBaseMoney)\n    for (let i in rateBase) {\n      let ss = rateBase[i].rate.toString().split(',').join('') * 1\n      let moneyUse = (Math.round(ss * baseMoneyRate * 100) / 100).toString()\n      let moneyPointArr = []\n      let getMoney = ''\n      moneyPointArr = moneyUse.split('.')\n      let moneyOne = moneyPointArr[0].split('').reverse()\n      let lenght = moneyOne.length\n      if (lenght >= 4) {\n        for (let i = 1, j = 0; i <= Math.floor(lenght / 3); i++, j++) {\n          if (moneyOne[3 * i + j]) {\n            moneyOne.splice(3 * i + j, 0, ',')\n          }\n        }\n      }\n      getMoney = moneyOne.reverse().join('')\n      if (moneyPointArr[1]) {\n        getMoney = getMoney + '.' + moneyPointArr[1]\n      }\n      rateUse[i].rate = getMoney || moneyUse\n    }\n    that.setData({\n      itemArr: rateUse\n    })\n  },\n  // numberLong (e) {\n  //   if (e.currentTarget.dataset.index * 1 + 1 === 12) {\n  //     console.log(1)\n  //   }\n  // },\n   /**\n   * 生命周期函数--监听页面加载\n   */\n  getRate () {\n    let that = this\n    wx.showLoading({\n      title: '更新数据中...',\n      mask: true\n    })\n    wx.request({\n      url: this.data.url2,\n      method: 'GET',\n      success (res) {\n        wx.hideLoading()\n        wx.stopPullDownRefresh()\n        for (let i of res.data.common) {\n          if (i.symbol === 'CNY') that.data.itemArr.CNY.rate = i.rate\n          else if (i.symbol === 'USD') that.data.itemArr.USD.rate = i.rate\n          else if (i.symbol === 'HKD') that.data.itemArr.HKD.rate = i.rate\n          else if (i.symbol === 'EUR') that.data.itemArr.EUR.rate = i.rate\n        }\n        that.setData({\n          itemArr: that.data.itemArr,\n          itemArrUse: that.data.itemArr\n        })\n        that.caculate()\n      }\n    })\n  },\n  onLoad () {\n    // TODO: onLoad\n    // let that = this\n    // let startArr = this.data.rateArr\n    // startArr.shift()\n    // for (let i = 0; i < startArr.length; i++) {\n    //   that.getRate('USD', startArr[i])\n    // }\n    this.getRate()\n  },\n\n  /**\n   * 生命周期函数--监听页面初次渲染完成\n   */\n  onReady () {\n    // TODO: onReady\n  },\n\n  /**\n   * 生命周期函数--监听页面显示\n   */\n  onShow () {\n    // TODO: onShow\n  },\n\n  /**\n   * 生命周期函数--监听页面隐藏\n   */\n  onHide () {\n    // TODO: onHide\n  },\n\n  /**\n   * 生命周期函数--监听页面卸载\n   */\n  onUnload () {\n    // TODO: onUnload\n  },\n\n  /**\n   * 页面相关事件处理函数--监听用户下拉动作\n   */\n  onPullDownRefresh () {\n    this.getRate()\n  },\n  onShareAppMessage: function () {\n    return {\n      title: '向您推荐一个有趣的小程序，快来围观吧',\n      path: '/pages/index/index'\n    }\n  }\n})\n"]}