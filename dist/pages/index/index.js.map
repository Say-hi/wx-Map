{"version":3,"sources":["pages/index/index.js"],"names":["app","getApp","Page","data","showText","show","zsIcon","getLocation","that","wx","type","success","res","lat","latitude","lng","longitude","getBaiduMap","fail","setData","loading","cloud","getbaidumap","location","then","baiduWeather","results","result","pois","length","v","tag","split","locInfo","getWeatherData","getWeather","weather","HeWeather6","getSevenWeatherData","catch","console","log","err","weatherSeven","daily_forecast","stopPullDownRefresh","getDayNote","topDate","getdatanote","date","Date","getFullYear","getMonth","getDate","setStorageSync","getStorageSync","opensetting","e","detail","authSetting","setTimeout","chooseCity","chooseLocation","cancel","showNear","maskshow","goPoint","openLocation","currentTarget","dataset","index","point","y","x","scale","name","address","showShares","canIUse","showShareMenu","showToast","title","image","mask","duration","onLoad","login","loadFontE","loadFontC","onReady","onShow","onHide","onUnload","onPullDownRefresh","onShareAppMessage","path"],"mappings":"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","file":"index.js","sourcesContent":["// 获取全局应用程序实例对象\r\n/*eslint-disable*/\r\nconst app = getApp()\r\n// const wxparse = require('../../wxParse/wxParse')\r\n// 创建页面实例对象\r\nPage({\r\n  /**\r\n   * 页面的初始数据\r\n   */\r\n  data: {\r\n    showText: '体验更多',\r\n    show: false,\r\n    zsIcon: ['icon-chuanyikunhuo', 'icon-xiche', 'icon-ganmaozhishu', 'icon-yundong', 'icon-ziwaixian']\r\n  },\r\n  getLocation () {\r\n    let that = this\r\n    wx.getLocation({\r\n      type: 'gcj02',\r\n      success (res) {\r\n        app.data.lat = res.latitude\r\n        app.data.lng = res.longitude\r\n        that.getBaiduMap(res.latitude, res.longitude)\r\n      },\r\n      fail (res) {}\r\n    })\r\n  },\r\n  getBaiduMap (lat, lng) {\r\n    let that = this\r\n    this.setData({\r\n      loading: true\r\n    })\r\n    app.cloud().getbaidumap({\r\n      type: 'baiduweather',\r\n      location: `${lng},${lat}`\r\n    })\r\n    .then(res => {\r\n      that.setData({\r\n        baiduWeather: res.results[0]\r\n      })\r\n    })\r\n\r\n    app.cloud().getbaidumap({\r\n      location: `${lat},${lng}`\r\n    })\r\n    .then(res =>{\r\n      if (res.result.pois &&res.result.pois.length >= 1) {\r\n        for (let v of res.result.pois) {\r\n          v.tag = v.tag.split(';')\r\n        }\r\n      }\r\n      that.setData({\r\n        locInfo: res.result\r\n      }, that.getWeatherData)\r\n    })\r\n  },\r\n  getWeatherData () {\r\n    let that = this\r\n    app.cloud().getWeather({type: 'now', location: `${app.data.lng},${app.data.lat}`})\r\n      .then(res => {\r\n        that.setData({\r\n          weather: res.HeWeather6[0]\r\n        }, that.getSevenWeatherData)\r\n      })\r\n      .catch(err => {\r\n        console.log(err)\r\n        that.getWeatherData()\r\n      })\r\n  },\r\n  getSevenWeatherData () {\r\n    let that = this\r\n    app.cloud().getWeather({type: 'forecast', location: `${app.data.lng},${app.data.lat}`})\r\n      .then(res => {\r\n        that.setData({\r\n          weatherSeven: res.HeWeather6[0].daily_forecast,\r\n          loading: false\r\n        })\r\n        wx.stopPullDownRefresh()\r\n      })\r\n      .catch(err => {\r\n        console.log(err)\r\n        that.getSevenWeatherData()\r\n      })\r\n  },\r\n  getDayNote () {\r\n    let that = this\r\n    if (this.data.topDate) return\r\n    app.cloud().getdatanote({date: new Date().getFullYear() + '-' + (new Date().getMonth() * 1 + 1) + '-' + new Date().getDate()})\r\n      .then(res => {\r\n        that.setData({\r\n          topDate: res.data,\r\n          show: true\r\n        })\r\n        wx.setStorageSync('topDate', res.data)\r\n      })\r\n      .catch(err => {\r\n        that.setData({\r\n          topDate: wx.getStorageSync('topDate')\r\n        })\r\n      })\r\n  },\r\n  opensetting (e) {\r\n    if (e.detail.authSetting['scope.userLocation']) {\r\n      let that = this\r\n      setTimeout(() => {\r\n        that.getLocation()\r\n      }, 100)\r\n    }\r\n  },\r\n  chooseCity () {\r\n    let that = this\r\n    wx.chooseLocation({\r\n      success (res) {\r\n        app.data.lat = res.latitude\r\n        app.data.lng = res.longitude\r\n        setTimeout(() => {\r\n          that.getBaiduMap(res.latitude, res.longitude)\r\n        }, 100)\r\n      },\r\n      cancel (res) {\r\n        console.log(res)\r\n      },\r\n      fail (res) {\r\n        console.log(res)\r\n      }\r\n    })\r\n  },\r\n  showNear () {\r\n    this.setData({\r\n      maskshow: !this.data.maskshow\r\n    })\r\n  },\r\n  goPoint (e) {\r\n    let that = this\r\n    wx.openLocation({\r\n      latitude: that.data.locInfo.pois[e.currentTarget.dataset.index].point.y,\r\n      longitude: that.data.locInfo.pois[e.currentTarget.dataset.index].point.x,\r\n      scale: 15,\r\n      name: that.data.locInfo.pois[e.currentTarget.dataset.index].name,\r\n      address: that.data.locInfo.pois[e.currentTarget.dataset.index].address\r\n    })\r\n  },\r\n\r\n  showShares () {\r\n    // wx.showShareMenu()\r\n    if (wx.canIUse('showShareMenu')) {\r\n      // console.log(1)\r\n      wx.showShareMenu()\r\n    } else {\r\n      wx.showToast({\r\n        title: '请小主点击右上角的按钮分享小程序给朋友',\r\n        image: '../../images/keai.png',\r\n        mask: 'true',\r\n        duration: 3000\r\n      })\r\n    }\r\n  },\r\n  // 获取服务器json数据\r\n  // getIndexData () {\r\n  //   var that = this\r\n  //   app.wxrequest({\r\n  //     url: app.data.baseDomain + '/api/wechatIndex2.json',\r\n  //     data: {},\r\n  //     success (res) {\r\n  //       wxparse.wxParse('content', 'html',res.data[0].content,that,5)\r\n  //       that.setData({\r\n  //         indexInfo: res.data[0],\r\n  //         shows: res.data[0].show == 1 ? true : false\r\n  //       })\r\n  //     }\r\n  //   })\r\n  // },\r\n  /**\r\n   * 生命周期函数--监听页面加载\r\n   */\r\n   onLoad () {\r\n    this.getLocation()\r\n    // this.getIndexData()\r\n    app.cloud().login()\r\n    app.loadFontE()\r\n    app.loadFontC()\r\n  },\r\n   /**\r\n   * 生命周期函数--监听页面初次渲染完成\r\n   */\r\n  onReady () {\r\n\r\n  },\r\n  /**\r\n   * 生命周期函数--监听页面显示\r\n   */\r\n  onShow () {\r\n    // this.changeColor()\r\n    this.getDayNote()\r\n    if (wx.getStorageSync('topDate')) {\r\n      this.setData({\r\n        topDate: wx.getStorageSync('topDate'),\r\n        show: true\r\n      })\r\n    }\r\n    // console.log(' ---------- onShow ----------')\r\n  },\r\n  /*\r\n   * 生命周期函数--监听页面隐藏\r\n   */\r\n  onHide () {\r\n    // console.log(' ---------- onHide ----------')\r\n  },\r\n  /**\r\n   * 生命周期函数--监听页面卸载\r\n   */\r\n  onUnload () {\r\n    // console.log(' ---------- onUnload ----------')\r\n  },\r\n  /**\r\n   * 页面相关事件处理函数--监听用户下拉动作\r\n   */\r\n  onPullDownRefresh () {\r\n    // this.getIndexData()\r\n    this.getLocation()\r\n  },\r\n  onShareAppMessage: function () {\r\n    return {\r\n      title: '向您推荐一个有趣的小程序，快来围观吧',\r\n      path: '/pages/index/index'\r\n    }\r\n  }\r\n})\r\n"]}