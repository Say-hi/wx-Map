{"version":3,"sources":["moneyPage/pages/money/money.js"],"names":["app","getApp","Page","data","curChoose","showFlag","first_number","itemArr","USD","img","country","moneyKind","CNY","HKD","EUR","caculateArr","rateArr","curIndex","choose","e","setData","currentTarget","dataset","index","flag","number","that","setTimeout","wx","showToast","title","image","mask","cur","money","rate","toString","split","join","caculate","indexOf","length","moneyDel","slice","scurs","moneys","scur","rateBase","gs","rateUse","rateBaseMoney","baseMoneyRate","i","ss","moneyUse","Math","round","moneyPointArr","getMoney","moneyOne","reverse","lenght","j","floor","splice","stopPullDownRefresh","getRate","loading","cloud","getExchangeRate","then","res","common","symbol","su","onLoad","loadFontE","onReady","onShow","onHide","onUnload","onPullDownRefresh","onShareAppMessage","path"],"mappings":";;AAAA;AACA,IAAMA,MAAMC,QAAZ;;AAEA;AACAC,KAAK;AACH;;;AAGAC,QAAM;AACJC,eAAW,KADP;AAEJC,cAAU,KAFN;AAGJC,kBAAc,KAHV;AAIJC,aAAS;AACPC,WAAK;AACHC,aAAK,yDADF;AAEHC,iBAAS,KAFN;AAGHC,mBAAW;AAHR,OADE;AAMPC,WAAK;AACHH,aAAK,yDADF;AAEHC,iBAAS,KAFN;AAGHC,mBAAW;AAHR,OANE;AAWPE,WAAK;AACHJ,aAAK,yDADF;AAEHC,iBAAS,KAFN;AAGHC,mBAAW;AAHR,OAXE;AAgBPG,WAAK;AACHL,aAAK,yDADF;AAEHC,iBAAS,KAFN;AAGHC,mBAAW;AAHR;AAhBE,KAJL;AA0BJI,iBAAa,CACX,CADW,EACR,CADQ,EACL,CADK,EACF,CADE,EACC,CADD,EACI,CADJ,EACO,CADP,EACU,CADV,EACa,CADb,EACgB,GADhB,EACqB,CADrB,EACwB,GADxB,CA1BT;AA6BJC,aAAS,CAAC,KAAD,EAAQ,KAAR,EAAe,KAAf,EAAsB,KAAtB,CA7BL;AA8BJC,cAAU;AA9BN,GAJH;AAoCH;AACAC,QArCG,kBAqCKC,CArCL,EAqCQ;AACT,SAAKC,OAAL,CAAa;AACXhB,iBAAWe,EAAEE,aAAF,CAAgBC,OAAhB,CAAwBC,KADxB;AAEXC,YAAM;AAFK,KAAb;AAID,GA1CE;;AA2CH;AACAC,QA5CG,kBA4CKN,CA5CL,EA4CQ;AACT,QAAIO,OAAO,IAAX;AACA,SAAKN,OAAL,CAAa;AACXH,gBAAUE,EAAEE,aAAF,CAAgBC,OAAhB,CAAwBC;AADvB,KAAb;AAGAI,eAAW,YAAY;AACrBD,WAAKN,OAAL,CAAa;AACXH,kBAAU;AADC,OAAb;AAGD,KAJD,EAIG,GAJH;AAKA,QAAI,CAAC,KAAKd,IAAL,CAAUqB,IAAf,EAAqB;AACnB,aAAOI,GAAGC,SAAH,CAAa;AAClBC,eAAO,OADW;AAElBC,eAAO,mBAFW;AAGlBC,cAAM;AAHY,OAAb,CAAP;AAKD;AACD,QAAIC,MAAM,KAAK9B,IAAL,CAAUC,SAApB;AACA,QAAIqB,SAASN,EAAEE,aAAF,CAAgBC,OAAhB,CAAwBC,KAAxB,GAAgC,CAAhC,GAAoC,CAAjD;AACA,QAAIW,QAAQR,KAAKvB,IAAL,CAAUI,OAAV,CAAkB0B,GAAlB,EAAuBE,IAAvB,CAA4BC,QAA5B,GAAuCC,KAAvC,CAA6C,GAA7C,EAAkDC,IAAlD,CAAuD,EAAvD,CAAZ;AACA;AACA,QAAI,CAAC,KAAKnC,IAAL,CAAUG,YAAf,EAA6B;AAC3B,UAAImB,SAAS,EAAb,EAAiB;AACfC,aAAKa,QAAL,CAAcN,GAAd,EAAmBR,MAAnB;AACD,OAFD,MAEO,IAAIA,WAAW,EAAf,EAAmB;AACxBC,aAAKa,QAAL,CAAcN,GAAd,EAAmB,GAAnB;AACD;AACD,UAAI,CAACP,KAAKvB,IAAL,CAAUE,QAAf,EAAyB;AACvBqB,aAAKN,OAAL,CAAa;AACXd,wBAAc;AADH,SAAb;AAGD;AACDoB,WAAKN,OAAL,CAAa;AACXf,kBAAU;AADC,OAAb;AAGA;AACD;AACD;AACA,QAAI6B,MAAMM,OAAN,CAAc,GAAd,IAAqB,CAArB,IAA0Bf,WAAW,EAAzC,EAA6C;AAC3C,UAAIS,MAAMM,OAAN,CAAc,GAAd,IAAqB,CAArB,KAA2BN,MAAMO,MAAN,GAAe,CAA9C,EAAiD;AAC/C,eAAOb,GAAGC,SAAH,CAAa;AAClBC,iBAAO,WADW;AAElBC,iBAAO,mBAFW;AAGlBC,gBAAM;AAHY,SAAb,CAAP;AAKD;AACF,KARD,MAQO;AACL,UAAIE,MAAMO,MAAN,GAAe,EAAf,IAAqBhB,WAAW,EAApC,EAAwC;AACtC,eAAOG,GAAGC,SAAH,CAAa;AAClBC,iBAAO,SADW;AAElBC,iBAAO,mBAFW;AAGlBC,gBAAM;AAHY,SAAb,CAAP;AAKD;AACF;AACD,QAAIP,SAAS,EAAb,EAAiB;AACfC,WAAKa,QAAL,CAAcN,GAAd,EAAmB,CAACC,QAAQT,MAAT,IAAmB,CAAtC;AACD,KAFD,MAEO,IAAIA,WAAW,EAAf,EAAmB;AACxB,UAAIS,MAAMM,OAAN,CAAc,GAAd,IAAqB,CAAzB,EAA4B;AAC1Bd,aAAKvB,IAAL,CAAUI,OAAV,CAAkB0B,GAAlB,EAAuBE,IAAvB,IAA+B,GAA/B;AACAT,aAAKN,OAAL,CAAa;AACXb,mBAASmB,KAAKvB,IAAL,CAAUI;AADR,SAAb;AAGD;AACF,KAPM,MAOA,IAAIkB,WAAW,EAAf,EAAmB;AACxB,UAAIS,MAAMM,OAAN,CAAc,GAAd,IAAqB,CAAzB,EAA4B;AAC1Bd,aAAKvB,IAAL,CAAUI,OAAV,CAAkB0B,GAAlB,EAAuBE,IAAvB,IAA+B,GAA/B;AACAT,aAAKN,OAAL,CAAa;AACXb,mBAASmB,KAAKvB,IAAL,CAAUI;AADR,SAAb;AAGA;AACD;AACD,UAAI2B,UAAU,GAAd,EAAmB;AACjB;AACD;AACDR,WAAKa,QAAL,CAAcN,GAAd,EAAmB,CAACC,QAAQ,GAAT,IAAgB,CAAnC;AACD,KAZM,MAYA,IAAIT,WAAW,EAAf,EAAmB;AACxB,UAAIS,SAAS,CAAb,EAAgB;AAChB,UAAIQ,WAAWR,MAAMS,KAAN,CAAY,CAAZ,EAAeT,MAAMO,MAAN,GAAe,CAA9B,CAAf;AACA,UAAIC,SAASD,MAAT,IAAmB,CAAvB,EAA0B;AACxB,eAAOf,KAAKa,QAAL,CAAcN,GAAd,EAAmB,GAAnB,CAAP;AACD;AACDP,WAAKa,QAAL,CAAcN,GAAd,EAAmBS,WAAW,CAA9B;AACD;AACF,GAhIE;;AAiIH;AACAH,UAlIG,oBAkIOK,KAlIP,EAkIcC,MAlId,EAkIsB;AACvB,QAAIC,OAAOF,SAAS,KAApB;AACA,QAAIV,QAAQW,UAAU,GAAtB;AACA,QAAInB,OAAO,IAAX;AACA,QAAIqB,WAAW/C,IAAIgD,EAAJ,CAAO,UAAP,CAAf;AACA,QAAIC,UAAU,KAAK9C,IAAL,CAAUI,OAAxB;AACA,QAAI2C,gBAAgBH,SAASD,IAAT,EAAeX,IAAf,CAAoBC,QAApB,GAA+BC,KAA/B,CAAqC,GAArC,EAA0CC,IAA1C,CAA+C,EAA/C,IAAqD,CAAzE;AACA,QAAIa,gBAAgBjB,QAASgB,aAA7B;AACA,SAAK,IAAIE,CAAT,IAAcL,QAAd,EAAwB;AACtB,UAAIM,KAAKN,SAASK,CAAT,EAAYjB,IAAZ,CAAiBC,QAAjB,GAA4BC,KAA5B,CAAkC,GAAlC,EAAuCC,IAAvC,CAA4C,EAA5C,IAAkD,CAA3D;AACA,UAAIgB,WAAW,CAACC,KAAKC,KAAL,CAAWH,KAAKF,aAAL,GAAqB,GAAhC,IAAuC,GAAxC,EAA6Cf,QAA7C,EAAf;AACA,UAAIqB,gBAAgB,EAApB;AACA,UAAIC,WAAW,EAAf;AACAD,sBAAgBH,SAASjB,KAAT,CAAe,GAAf,CAAhB;AACA,UAAIsB,WAAWF,cAAc,CAAd,EAAiBpB,KAAjB,CAAuB,EAAvB,EAA2BuB,OAA3B,EAAf;AACA,UAAIC,SAASF,SAASlB,MAAtB;AACA,UAAIoB,UAAU,CAAd,EAAiB;AACf,aAAK,IAAIT,KAAI,CAAR,EAAWU,IAAI,CAApB,EAAuBV,MAAKG,KAAKQ,KAAL,CAAWF,SAAS,CAApB,CAA5B,EAAoDT,MAAKU,GAAzD,EAA8D;AAC5D,cAAIH,SAAS,IAAIP,EAAJ,GAAQU,CAAjB,CAAJ,EAAyB;AACvBH,qBAASK,MAAT,CAAgB,IAAIZ,EAAJ,GAAQU,CAAxB,EAA2B,CAA3B,EAA8B,GAA9B;AACD;AACF;AACF;AACDJ,iBAAWC,SAASC,OAAT,GAAmBtB,IAAnB,CAAwB,EAAxB,CAAX;AACA,UAAImB,cAAc,CAAd,CAAJ,EAAsB;AACpBC,mBAAWA,WAAW,GAAX,GAAiBD,cAAc,CAAd,CAA5B;AACD;AACDR,cAAQG,CAAR,EAAWjB,IAAX,GAAkBuB,YAAYJ,QAA9B;AACD;AACD1B,OAAGqC,mBAAH;AACAvC,SAAKN,OAAL,CAAa;AACXb,eAAS0C;AADE,KAAb;AAGD,GAnKE;;AAoKF;;;AAGDiB,SAvKG,qBAuKQ;AACT,QAAIxC,OAAO,IAAX;AACA,SAAKN,OAAL,CAAa;AACX+C,eAAS;AADE,KAAb;AAGAnE,QAAIoE,KAAJ,GAAYC,eAAZ,GACGC,IADH,CACQ,eAAO;AAAA;AAAA;AAAA;;AAAA;AACX,6BAAcC,IAAIC,MAAlB,8HAA0B;AAAA,cAAjBpB,CAAiB;;AACxB,cAAIA,EAAEqB,MAAF,KAAa,KAAjB,EAAwB/C,KAAKvB,IAAL,CAAUI,OAAV,CAAkBK,GAAlB,CAAsB,MAAtB,IAAgCwC,EAAEjB,IAAlC,CAAxB,KACK,IAAIiB,EAAEqB,MAAF,KAAa,KAAjB,EAAwB/C,KAAKvB,IAAL,CAAUI,OAAV,CAAkBC,GAAlB,CAAsB,MAAtB,IAAgC4C,EAAEjB,IAAlC,CAAxB,KACA,IAAIiB,EAAEqB,MAAF,KAAa,KAAjB,EAAwB/C,KAAKvB,IAAL,CAAUI,OAAV,CAAkBM,GAAlB,CAAsB,MAAtB,IAAgCuC,EAAEjB,IAAlC,CAAxB,KACA,IAAIiB,EAAEqB,MAAF,KAAa,KAAjB,EAAwB/C,KAAKvB,IAAL,CAAUI,OAAV,CAAkBO,GAAlB,CAAsB,MAAtB,IAAgCsC,EAAEjB,IAAlC;AAC9B;AANU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAOXnC,UAAI0E,EAAJ,CAAO,UAAP,EAAmBhD,KAAKvB,IAAL,CAAUI,OAA7B;AACAmB,WAAKN,OAAL,CAAa;AACXb,iBAASmB,KAAKvB,IAAL,CAAUI,OADR;AAEX4D,iBAAS;AAFE,OAAb;AAIAzC,WAAKa,QAAL;AACD,KAdH;AAeD,GA3LE;AA4LHoC,QA5LG,oBA4LO;AACR3E,QAAI4E,SAAJ;AACA,SAAKV,OAAL;AACD,GA/LE;;;AAiMH;;;AAGAW,SApMG,qBAoMQ;AACT;AACD,GAtME;;;AAwMH;;;AAGAC,QA3MG,oBA2MO;AACR;AACD,GA7ME;;;AA+MH;;;AAGAC,QAlNG,oBAkNO;AACR;AACD,GApNE;;;AAsNH;;;AAGAC,UAzNG,sBAyNS;AACV;AACD,GA3NE;;;AA6NH;;;AAGAC,mBAhOG,+BAgOkB;AACnB,SAAKf,OAAL;AACD,GAlOE;;AAmOHgB,qBAAmB,6BAAY;AAC7B,WAAO;AACLpD,aAAO,oBADF;AAELqD,YAAM;AAFD,KAAP;AAID;AAxOE,CAAL","file":"money.js","sourcesContent":["// 获取全局应用程序实例对象\nconst app = getApp()\n\n// 创建页面实例对象\nPage({\n  /**\n   * 页面的初始数据\n   */\n  data: {\n    curChoose: 'xxx',\n    showFlag: false,\n    first_number: false,\n    itemArr: {\n      USD: {\n        img: 'https://7465-teach-1258324355.tcb.qcloud.la/tab/usd.png',\n        country: 'USD',\n        moneyKind: '美元/$'\n      },\n      CNY: {\n        img: 'https://7465-teach-1258324355.tcb.qcloud.la/tab/cny.png',\n        country: 'CNY',\n        moneyKind: '人民币/￥'\n      },\n      HKD: {\n        img: 'https://7465-teach-1258324355.tcb.qcloud.la/tab/hkd.png',\n        country: 'HKD',\n        moneyKind: '港币HK/￥'\n      },\n      EUR: {\n        img: 'https://7465-teach-1258324355.tcb.qcloud.la/tab/eur.png',\n        country: 'EUR',\n        moneyKind: '欧元/€'\n      }\n    },\n    caculateArr: [\n      1, 2, 3, 4, 5, 6, 7, 8, 9, '.', 0, '←'\n    ],\n    rateArr: ['USD', 'CNY', 'HKD', 'EUR'],\n    curIndex: 99\n  },\n  // 货币初始单位选择\n  choose (e) {\n    this.setData({\n      curChoose: e.currentTarget.dataset.index,\n      flag: true\n    })\n  },\n  // 键盘\n  number (e) {\n    let that = this\n    this.setData({\n      curIndex: e.currentTarget.dataset.index\n    })\n    setTimeout(function () {\n      that.setData({\n        curIndex: 99\n      })\n    }, 100)\n    if (!this.data.flag) {\n      return wx.showToast({\n        title: '请选择币种',\n        image: '/images/hi_HL.png',\n        mask: true\n      })\n    }\n    let cur = this.data.curChoose\n    let number = e.currentTarget.dataset.index * 1 + 1\n    let money = that.data.itemArr[cur].rate.toString().split(',').join('')\n    // 第一次点击清空\n    if (!this.data.first_number) {\n      if (number < 10) {\n        that.caculate(cur, number)\n      } else if (number === 11) {\n        that.caculate(cur, '0')\n      }\n      if (!that.data.showFlag) {\n        that.setData({\n          first_number: true\n        })\n      }\n      that.setData({\n        showFlag: true\n      })\n      return\n    }\n    // 非第一次点击\n    if (money.indexOf('.') > 0 && number !== 12) {\n      if (money.indexOf('.') + 2 === money.length - 1) {\n        return wx.showToast({\n          title: '不能有比分更小的啦',\n          image: '/images/hi_HL.png',\n          mask: true\n        })\n      }\n    } else {\n      if (money.length > 12 && number !== 12) {\n        return wx.showToast({\n          title: '超出计算范围啦',\n          image: '/images/hi_HL.png',\n          mask: true\n        })\n      }\n    }\n    if (number < 10) {\n      that.caculate(cur, (money + number) * 1)\n    } else if (number === 10) {\n      if (money.indexOf('.') < 0) {\n        that.data.itemArr[cur].rate += '.'\n        that.setData({\n          itemArr: that.data.itemArr\n        })\n      }\n    } else if (number === 11) {\n      if (money.indexOf('.') > 0) {\n        that.data.itemArr[cur].rate += '0'\n        that.setData({\n          itemArr: that.data.itemArr\n        })\n        return\n      }\n      if (money === '0') {\n        return\n      }\n      that.caculate(cur, (money + '0') * 1)\n    } else if (number === 12) {\n      if (money <= 0) return\n      let moneyDel = money.slice(0, money.length - 1)\n      if (moneyDel.length <= 0) {\n        return that.caculate(cur, '0')\n      }\n      that.caculate(cur, moneyDel * 1)\n    }\n  },\n  // 计算\n  caculate (scurs, moneys) {\n    let scur = scurs || 'CNY'\n    let money = moneys || 100\n    let that = this\n    let rateBase = app.gs('rateBase')\n    let rateUse = this.data.itemArr\n    let rateBaseMoney = rateBase[scur].rate.toString().split(',').join('') * 1\n    let baseMoneyRate = money / (rateBaseMoney)\n    for (let i in rateBase) {\n      let ss = rateBase[i].rate.toString().split(',').join('') * 1\n      let moneyUse = (Math.round(ss * baseMoneyRate * 100) / 100).toString()\n      let moneyPointArr = []\n      let getMoney = ''\n      moneyPointArr = moneyUse.split('.')\n      let moneyOne = moneyPointArr[0].split('').reverse()\n      let lenght = moneyOne.length\n      if (lenght >= 4) {\n        for (let i = 1, j = 0; i <= Math.floor(lenght / 3); i++, j++) {\n          if (moneyOne[3 * i + j]) {\n            moneyOne.splice(3 * i + j, 0, ',')\n          }\n        }\n      }\n      getMoney = moneyOne.reverse().join('')\n      if (moneyPointArr[1]) {\n        getMoney = getMoney + '.' + moneyPointArr[1]\n      }\n      rateUse[i].rate = getMoney || moneyUse\n    }\n    wx.stopPullDownRefresh()\n    that.setData({\n      itemArr: rateUse\n    })\n  },\n   /**\n   * 生命周期函数--监听页面加载\n   */\n  getRate () {\n    let that = this\n    this.setData({\n      loading: true\n    })\n    app.cloud().getExchangeRate()\n      .then(res => {\n        for (let i of res.common) {\n          if (i.symbol === 'CNY') that.data.itemArr.CNY['rate'] = i.rate\n          else if (i.symbol === 'USD') that.data.itemArr.USD['rate'] = i.rate\n          else if (i.symbol === 'HKD') that.data.itemArr.HKD['rate'] = i.rate\n          else if (i.symbol === 'EUR') that.data.itemArr.EUR['rate'] = i.rate\n        }\n        app.su('rateBase', that.data.itemArr)\n        that.setData({\n          itemArr: that.data.itemArr,\n          loading: false\n        })\n        that.caculate()\n      })\n  },\n  onLoad () {\n    app.loadFontE()\n    this.getRate()\n  },\n\n  /**\n   * 生命周期函数--监听页面初次渲染完成\n   */\n  onReady () {\n    // TODO: onReady\n  },\n\n  /**\n   * 生命周期函数--监听页面显示\n   */\n  onShow () {\n    // TODO: onShow\n  },\n\n  /**\n   * 生命周期函数--监听页面隐藏\n   */\n  onHide () {\n    // TODO: onHide\n  },\n\n  /**\n   * 生命周期函数--监听页面卸载\n   */\n  onUnload () {\n    // TODO: onUnload\n  },\n\n  /**\n   * 页面相关事件处理函数--监听用户下拉动作\n   */\n  onPullDownRefresh () {\n    this.getRate()\n  },\n  onShareAppMessage: function () {\n    return {\n      title: '向您推荐一个有趣的小程序，快来围观吧',\n      path: '/pages/index/index'\n    }\n  }\n})\n"]}